(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    230981,       5461]
NotebookOptionsPosition[    229498,       5427]
NotebookOutlinePosition[    230101,       5449]
CellTagsIndexPosition[    230016,       5444]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Guess", " ", "routine", " ", "for", " ", "\[Omega]"}], "-", " ", 
    "\[Nu]", "-", "values"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"\[Mu]IterationCounter", "\[GreaterEqual]", "6"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"If", " ", 
        RowBox[{"we", "'"}], "re", " ", "on", " ", "the", " ", "6", "th", " ",
         "iteration"}], ",", " ", 
       RowBox[{
       "use", " ", "previous", " ", "values", " ", "to", " ", "approximate", 
        " ", "current", " ", "frequency", " ", "value", " ", "using", " ", 
        "fit", " ", "functions"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Omega]ValHistory", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"\[Omega]Holder", "[", "iter", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"iter", ",", 
           RowBox[{"\[Mu]IterationCounter", "-", "5"}], ",", 
           RowBox[{"\[Mu]IterationCounter", "-", "1"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"\[Nu]ValHistory", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"\[Nu]Holder", "[", "iter", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"iter", ",", 
           RowBox[{"\[Mu]IterationCounter", "-", "5"}], ",", 
           RowBox[{"\[Mu]IterationCounter", "-", "1"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"\[Mu]ValHistory", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"\[Mu]Holder", "[", "iter", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"iter", ",", 
           RowBox[{"\[Mu]IterationCounter", "-", "5"}], ",", 
           RowBox[{"\[Mu]IterationCounter", "-", "1"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Omega]Fit", "[", "\[Mu]IterationCounter", "]"}], " ", "=", 
       " ", 
       RowBox[{"Fit", "[", 
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{"{", 
           RowBox[{"\[Mu]ValHistory", ",", " ", "\[Omega]ValHistory"}], "}"}],
           "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"1", ",", "\[Zeta]", ",", 
           SuperscriptBox["\[Zeta]", "2"], ",", " ", 
           SuperscriptBox["\[Zeta]", "3"], ",", " ", 
           SuperscriptBox["\[Zeta]", "4"]}], "}"}], ",", " ", "\[Zeta]", ",", 
         " ", 
         RowBox[{"WorkingPrecision", "\[Rule]", "precision"}]}], "]"}]}], " ", 
      RowBox[{"(*", 
       RowBox[{"InterpolatingPolynomial", "[", 
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{"{", 
           RowBox[{"\[Mu]ValHistory", ",", " ", "\[Omega]ValHistory"}], "}"}],
           "]"}], ",", "\[Zeta]"}], "]"}], "*)"}], 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Interp", ".", " ", "Poly"}], " ", "seems", " ", "to", " ", 
          "fail", " ", "for", " ", "\[Omega]"}], "-", 
         RowBox[{"values", " ", "near", " ", "\[Mu]"}]}], "=", "0.4"}], 
       "*)"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Nu]Fit", "[", "\[Mu]IterationCounter", "]"}], "=", 
       RowBox[{"Fit", "[", 
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{"{", 
           RowBox[{"\[Mu]ValHistory", ",", " ", "\[Nu]ValHistory"}], "}"}], 
          "]"}], ",", "  ", 
         RowBox[{"{", 
          RowBox[{"1", ",", "\[Zeta]", ",", 
           SuperscriptBox["\[Zeta]", "2"], ",", " ", 
           SuperscriptBox["\[Zeta]", "3"], ",", " ", 
           SuperscriptBox["\[Zeta]", "4"]}], "}"}], ",", " ", "\[Zeta]", ",", 
         " ", 
         RowBox[{"WorkingPrecision", "\[Rule]", "precision"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"Current\[Omega]Guess", " ", "=", " ", 
       RowBox[{
        RowBox[{"\[Omega]Fit", "[", "\[Mu]IterationCounter", "]"}], "/.", 
        RowBox[{"\[Zeta]", "\[Rule]", 
         RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Current\[Nu]Guess", " ", "=", " ", 
       RowBox[{
        RowBox[{"\[Nu]Fit", "[", "\[Mu]IterationCounter", "]"}], "/.", 
        RowBox[{"\[Zeta]", "->", 
         RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"omegaGuess", " ", "=", " ", "Current\[Omega]Guess"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nuGuess", " ", "=", " ", 
       RowBox[{
        RowBox[{"getNuValue", "[", 
         RowBox[{
         "omegaGuess", ",", " ", "parameters", ",", " ", 
          "Current\[Nu]Guess"}], "]"}], "//", "N"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Nu]FitFunction", "[", "\[Mu]IterationCounter", "]"}], " ", 
       "=", " ", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", "\[Zeta]", "}"}], ",", " ", 
         RowBox[{"Evaluate", "@", 
          RowBox[{"\[Nu]Fit", "[", "\[Mu]IterationCounter", "]"}]}]}], 
        "]"}]}]}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"use", " ", "non"}], "-", 
       RowBox[{
       "rel", " ", "limit", " ", "for", " ", "initial", " ", "guess", " ", 
        "of", " ", "\[Omega]", " ", "in", " ", "first", " ", "4", " ", 
        "iterations"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"omegaGuess", " ", "=", " ", 
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{"omegaNRNonRel", "[", "parameters", "]"}], " ", "+", " ", 
         RowBox[{"I", "*", 
          RowBox[{"omegaNINonRel", "[", "parameters", "]"}]}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"nuGuess", " ", "=", " ", 
       RowBox[{
        RowBox[{"getNuValue", "[", 
         RowBox[{"omegaGuess", ",", " ", "parameters", ",", 
          RowBox[{"nuNNonRel", "[", 
           RowBox[{"omegaGuess", ",", "parameters"}], "]"}]}], "]"}], "//", 
        "N"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}]], "Input",
 CellChangeTimes->{{3.868332301972781*^9, 
  3.868332310552238*^9}},ExpressionUUID->"b0602965-dfc1-41f7-b9ca-\
eacc8b02c1dc"],

Cell[CellGroupData[{

Cell["        Functions", "Subsection",
 CellChangeTimes->{{3.860198747935575*^9, 3.860198748606625*^9}, {
  3.8602848790395737`*^9, 
  3.8602848793456984`*^9}},ExpressionUUID->"821cf547-bc04-4bb9-a3f8-\
20108d5951a7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"NotebookFind", "[", 
       RowBox[{
        RowBox[{"EvaluationNotebook", "[", "]"}], ",", "#", ",", "All", ",", 
        "CellTags", ",", " ", 
        RowBox[{"AutoScroll", "\[Rule]", "False"}]}], "]"}], ";", 
      RowBox[{"SelectionEvaluate", "[", 
       RowBox[{
        RowBox[{"EvaluationNotebook", "[", "]"}], ",", " ", 
        RowBox[{"AutoScroll", "\[Rule]", "False"}]}], "]"}]}], ")"}], "&"}], "/@", 
   RowBox[{"{", 
    RowBox[{
    "\"\<AngularSetup\>\"", ",", " ", "\"\<RadialSetup\>\"", ",", " ", 
     "\"\<CalculationParameters\>\""}], "}"}]}], ";"}]], "Input",
 CellLabel->"In[16]:=",ExpressionUUID->"e93cffd4-3faa-46cb-9096-8d3ba53c08f1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"define", " ", "some", " ", "functions"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"RadialMesh", "::", "usage"}], " ", "=", " ", 
     "\"\<Generate mesh which is denser in the region near rstart and sparse \
near rstop. Density function is determined by last argument, with default \
(\\!\\(\\*SuperscriptBox[\\(#\\), \\(2\\)]\\)&).\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"RadialMesh", "[", 
      RowBox[{"rstart_", ",", "rstop_", ",", "points_", ",", " ", 
       RowBox[{"densityfunc_", ":", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "x", "}"}], ",", 
          RowBox[{"x", "^", "2"}]}], "]"}]}]}], "]"}], ":=", "\n", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"c", " ", "=", 
          RowBox[{
           RowBox[{"(", " ", 
            RowBox[{
             RowBox[{"densityfunc", "[", "rstop", "]"}], "-", 
             RowBox[{"densityfunc", "[", "rstart", "]"}]}], ")"}], "/", 
           RowBox[{"(", 
            RowBox[{"rstop", "-", "rstart"}], ")"}]}]}], ",", " ", 
         RowBox[{"b", "=", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"rstop", " ", 
              RowBox[{"densityfunc", "[", "rstart", "]"}]}], "-", 
             RowBox[{"rstart", " ", 
              RowBox[{"densityfunc", "[", "rstop", "]"}]}]}], ")"}], "/", 
           RowBox[{"(", " ", 
            RowBox[{
             RowBox[{"densityfunc", "[", "rstart", "]"}], "-", " ", 
             RowBox[{"densityfunc", "[", "rstop", "]"}]}], ")"}]}]}]}], "}"}],
        ",", "\n", "\n", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"densityfunc", "[", "i", "]"}], "/", "c"}], "+", "b"}], 
         ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", "rstart", ",", " ", "rstop", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"rstop", "-", "rstart"}], ")"}], "/", "points"}]}], 
          "}"}]}], "]"}]}], "\n", "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"ThetaMesh", "[", 
     RowBox[{"\[Theta]start_", ",", "\[Theta]stop_", ",", " ", "points_"}], 
     "]"}], ":=", 
    RowBox[{"Table", "[", 
     RowBox[{"i", ",", " ", 
      RowBox[{"{", 
       RowBox[{"i", ",", "\[Theta]start", ",", " ", "\[Theta]stop", ",", 
        RowBox[{"N", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"\[Theta]stop", "-", "\[Theta]start"}], ")"}], "/", 
           "points"}], ")"}]}]}], "}"}]}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{"PhiMesh", "[", 
     RowBox[{"\[Phi]start_", ",", " ", "\[Phi]stop_", ",", " ", "points_"}], 
     "]"}], ":=", "\n", 
    RowBox[{"Table", "[", 
     RowBox[{"i", ",", " ", 
      RowBox[{"{", 
       RowBox[{"i", ",", "\[Phi]start", ",", " ", "\[Phi]stop", ",", 
        RowBox[{"N", "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"\[Phi]stop", "-", "\[Phi]start"}], ")"}], "/", 
           "points"}], ")"}]}]}], "}"}]}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{"TwoDMesh", "[", 
     RowBox[{
     "rstart_", ",", "rstop_", ",", "\[Theta]start_", ",", "\[Theta]stop_", 
      ",", " ", "rpoints_", ",", "\[Theta]points_", ",", 
      RowBox[{"densityfunc_", ":", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", "^", "4"}], "&"}], ")"}]}]}], "]"}], ":=", 
    RowBox[{"SparseArray", "@", 
     RowBox[{"Tuples", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RadialMesh", "[", 
         RowBox[{
         "rstart", ",", " ", "rstop", ",", " ", "rpoints", ",", " ", 
          "densityfunc"}], "]"}], ",", 
        RowBox[{"ThetaMesh", "[", 
         RowBox[{
         "\[Theta]start", ",", "\[Theta]stop", ",", "\[Theta]points"}], 
         "]"}]}], "}"}], "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"ThreeDMesh", "[", 
     RowBox[{
     "rstart_", ",", "rstop_", ",", "\[Theta]start_", ",", "\[Theta]stop_", 
      ",", "\[Phi]start_", ",", " ", "\[Phi]stop_", ",", "  ", "rpoints_", 
      ",", "\[Theta]points_", ",", "\[Phi]points_", ",", " ", 
      RowBox[{"densityfunc_", ":", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", "^", "4"}], "&"}], ")"}]}]}], "]"}], ":=", 
    RowBox[{"SparseArray", "@", 
     RowBox[{"Tuples", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"RadialMesh", "[", 
         RowBox[{
         "rstart", ",", " ", "rstop", ",", " ", "rpoints", ",", " ", 
          "densityfunc"}], "]"}], ",", 
        RowBox[{"ThetaMesh", "[", 
         RowBox[{
         "\[Theta]start", ",", "\[Theta]stop", ",", "\[Theta]points"}], "]"}],
         ",", " ", 
        RowBox[{"PhiMesh", "[", 
         RowBox[{
         "\[Phi]start", ",", " ", "\[Phi]stop", ",", " ", "\[Phi]points"}], 
         "]"}]}], "}"}], "]"}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{"Generate2DInterpolation", "[", 
     RowBox[{
     "func_", ",", "rstart_", ",", "rstop_", ",", "\[Theta]start_", ",", 
      "\[Theta]stop_", ",", " ", "rpoints_", ",", "\[Theta]points_", ",", 
      RowBox[{"densityfunc_", ":", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", "^", "4"}], "&"}], ")"}]}]}], "]"}], ":=", "\n", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"dom", ",", " ", "funcEval"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"dom", " ", "=", " ", 
        RowBox[{"TwoDMesh", "[", 
         RowBox[{
         "rstart", ",", " ", "rstop", ",", " ", "\[Theta]start", ",", " ", 
          "\[Theta]stop", ",", " ", "rpoints", ",", " ", "\[Theta]points", 
          ",", " ", "densityfunc"}], "]"}]}], ";", "\n", 
       RowBox[{"funcEval", " ", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"func", "[", 
            RowBox[{"Sequence", "@@", "#"}], "]"}], "&"}], ",", "dom"}], 
         "]"}]}], ";", "\n", 
       RowBox[{"Return", "[", 
        RowBox[{"Interpolation", "[", 
         RowBox[{"Normal", "[", 
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"dom", ",", "funcEval"}], "}"}], "]"}], "]"}], "]"}], 
        "]"}]}]}], "\n", "]"}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"Generate3DInterpolation", "::", "usage"}], "=", 
     "\"\<Generate interpolation function for a 3D function evaluated over a \
Mesh. \n\n\
Generate3DInterpolation[func_,rstart_,rstop_,\[Theta]start_,\[Theta]stop_,\
\[Phi]start_, \[Phi]stop_, \
rpoints_,\[Theta]points_,\[Phi]points_,densityfunc_:(\\!\\(\\*SuperscriptBox[\
\\(#\\), \\(4\\)]\\)&)]\n\ndensityfunc specifies how dense the mesh should be \
in the radial direction. The reciprocal of the derivative of the density \
function determines the density of points, i.e. smaller values of \
\\!\\(\\*SuperscriptBox[\\(f\\), \\(\[Prime]\\)]\\) map to larger values of \
density. Note, the total number of points is conserved.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{"Generate3DInterpolation", "[", 
     RowBox[{
     "func_", ",", "rstart_", ",", "rstop_", ",", "\[Theta]start_", ",", 
      "\[Theta]stop_", ",", "\[Phi]start_", ",", " ", "\[Phi]stop_", ",", " ",
       "rpoints_", ",", "\[Theta]points_", ",", "\[Phi]points_", ",", 
      RowBox[{"densityfunc_", ":", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"#", "^", "4"}], "&"}], ")"}]}]}], "]"}], ":=", "\n", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "\n", 
       RowBox[{
       "functionOnPoints", ",", "\n", "NewRadialPoint", ",", "\n", "dom", ",",
         "\n", "isOptimized", ",", "\n", "Messenger", ",", "\n", "retval", 
        ",", "\n", "funcOE", ",", "\n", 
        RowBox[{"$MaxExtraPrecision", "=", "100"}], ",", "\n", 
        RowBox[{"c", " ", "=", 
         RowBox[{
          RowBox[{"(", " ", 
           RowBox[{
            RowBox[{"densityfunc", "[", "rstop", "]"}], "-", 
            RowBox[{"densityfunc", "[", "rstart", "]"}]}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"rstop", "-", "rstart"}], ")"}]}]}], ",", " ", 
        RowBox[{"b", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"rstop", " ", 
             RowBox[{"densityfunc", "[", "rstart", "]"}]}], "-", 
            RowBox[{"rstart", " ", 
             RowBox[{"densityfunc", "[", "rstop", "]"}]}]}], ")"}], "/", 
          RowBox[{"(", " ", 
           RowBox[{
            RowBox[{"densityfunc", "[", "rstart", "]"}], "-", " ", 
            RowBox[{"densityfunc", "[", "rstop", "]"}]}], ")"}]}]}]}], "\n", 
       "}"}], ",", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "This", " ", "function", " ", "increases", " ", "the", " ", "density",
          " ", "of", " ", "points", " ", "near", " ", "rstart"}], ",", " ", 
        RowBox[{
        "accompanied", " ", "by", " ", "a", " ", "decrease", " ", "near", " ",
          "rstop", " ", "such", " ", "that", " ", "rpoints", " ", "is", " ", 
         RowBox[{"conserved", "."}]}]}], "*)"}], "\n", 
      RowBox[{
       RowBox[{
        RowBox[{"NewRadialPoint", "[", "i_", "]"}], ":=", 
        RowBox[{
         RowBox[{
          RowBox[{"densityfunc", "[", "i", "]"}], "/", "c"}], "+", "b"}]}], 
       ";", "\n", 
       RowBox[{"dom", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"NewRadialPoint", "[", "r", "]"}], ",", "\[Theta]", ",",
               "\[Phi]"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"r", ",", "rstart", ",", "rstop", ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"rstop", "-", "rstart"}], ")"}], "/", "rpoints"}]}], 
             "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
             "\[Theta]", ",", "\[Theta]start", ",", "\[Theta]stop", ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"\[Theta]stop", "-", "\[Theta]start"}], ")"}], "/", 
               "\[Theta]points"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"\[Phi]", ",", "\[Phi]start", ",", "\[Phi]stop", ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"\[Phi]stop", "-", "\[Phi]start"}], ")"}], "/", 
               "\[Phi]points"}]}], "}"}]}], "]"}], ",", "2"}], "]"}]}], ";", 
       "\n", "\n", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Was", " ", "func", " ", "generated", " ", "from", " ", 
          RowBox[{"OptimizeFunction", "?", " ", "Kind"}], " ", "of", " ", "a",
           " ", "hacky", " ", "way", " ", "of", " ", "checking"}], "..."}], 
        "*)"}], "\n", 
       RowBox[{"isOptimized", " ", "=", "  ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"TrueQ", "[", 
           RowBox[{
            RowBox[{"Head", "[", "func", "]"}], "==", "Function"}], "]"}], 
          ",", " ", "False", ",", " ", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tmpfunc$", "=", 
              RowBox[{"Evaluate", "[", "func", "]"}]}], "}"}], ",", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"DownValues", "[", "tmpfunc$", "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"Verbatim", "@", 
               RowBox[{"HoldPattern", "[", 
                RowBox[{"tmpfunc$", "[", "Properties", "]"}], "]"}]}]}], 
             "]"}]}], "]"}]}], "]"}]}], ";", "\n", 
       RowBox[{"Messenger", " ", "=", " ", 
        RowBox[{"Unique", "[", "Messenger", "]"}]}], ";", "\n", 
       RowBox[{"PrintTemporary", "[", 
        RowBox[{"Dynamic", "[", "Messenger", "]"}], "]"}], ";", "\n", 
       RowBox[{"ParallelEvaluate", "[", 
        RowBox[{"$MaxExtraPrecision", "=", "1000"}], "]"}], ";", "\n", 
       RowBox[{"ParallelEvaluate", "[", 
        RowBox[{"Off", "[", 
         RowBox[{"N", "::", "meprec"}], "]"}], "]"}], ";", "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Head", "[", "func", "]"}], "==", "Symbol"}], ")"}], "&&",
           "isOptimized"}], ",", "\n", 
         RowBox[{
          RowBox[{"Messenger", "=", "\"\<Mapping function over mesh\>\""}], 
          ";", "\n", 
          RowBox[{"functionOnPoints", " ", "=", " ", 
           RowBox[{"ParallelMap", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"N", "[", 
               RowBox[{"func", "@@", "#"}], "]"}], "&"}], ",", "dom"}], 
            "]"}]}], ";"}], "\n", ",", "\n", "\n", 
         RowBox[{
          RowBox[{"Messenger", "=", "\"\<Optimizing function\>\""}], ";", 
          "\n", 
          RowBox[{"funcOE", " ", "=", " ", 
           RowBox[{"OptimizedFunction", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], ",", " ", 
             
             RowBox[{"func", "[", 
              RowBox[{"r", ",", "\[Theta]", ",", "\[Phi]"}], "]"}]}], "]"}]}],
           ";", "\n", 
          RowBox[{"Messenger", "=", "\"\<Mapping function over mesh\>\""}], 
          ";", "\n", 
          RowBox[{"functionOnPoints", " ", "=", " ", 
           RowBox[{"ParallelMap", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"N", "[", 
               RowBox[{"funcOE", "@@", "#"}], "]"}], "&"}], ",", "dom"}], 
            "]"}]}], ";"}]}], "\n", "]"}], ";", "\n", 
       RowBox[{
       "Messenger", "=", "\"\<Generating interpolation function\>\""}], ";", 
       "\n", 
       RowBox[{"retval", " ", "=", " ", 
        RowBox[{"Interpolation", "[", 
         RowBox[{"Normal", "[", 
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"dom", ",", " ", "functionOnPoints"}], "}"}], "]"}], 
          "]"}], "]"}]}], ";", "\n", 
       RowBox[{"Return", "[", "retval", "]"}]}]}], "\n", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CacheResults", "[", 
      RowBox[{"assoc_", ",", " ", "filename_"}], "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"(", 
      RowBox[{"Export", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
         RowBox[{"ToString", "[", "filename", "]"}], "<>", "\"\<.mx\>\""}], 
        ",", " ", "assoc"}], "]"}], ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"assocToString", "[", "assoc_", "]"}], ":=", 
    RowBox[{"StringReplace", "[", 
     RowBox[{
      RowBox[{"StringJoin", "@@", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ToString", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"assoc", "//", "Keys"}], ")"}], "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", " ", "InputForm"}], "]"}], "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"assoc", "//", "Values"}], ")"}], "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", " ", "InputForm"}], "]"}]}],
          ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", "1", ",", " ", 
           RowBox[{"Length", "[", 
            RowBox[{"assoc", "//", "Keys"}], "]"}]}], "}"}]}], "]"}]}], ",", 
      " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\</\>\"", "\[Rule]", " ", "\"\<_\>\""}], ",", " ", 
        RowBox[{"\"\<\\\"\>\"", "\[Rule]", " ", "\"\<\>\""}]}], "}"}]}], 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"R2toC", "[", "vec_", "]"}], ":=", 
     RowBox[{
      RowBox[{"vec", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "+", 
      RowBox[{"I", "*", 
       RowBox[{"vec", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"IterabletoList", "[", "iter_", "]"}], ":=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"iter", "[", 
       RowBox[{"[", "i", "]"}], "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"iter", "//", "Length"}]}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DisjunctiontoList", "[", "disj_", "]"}], ":=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "&"}], ",", 
      RowBox[{"IterabletoList", "[", "disj", "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ToPrecision", "[", "expr_", "]"}], ":=", 
     RowBox[{"SetPrecision", "[", 
      RowBox[{"expr", ",", " ", "precision"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TotalQuantum", "[", 
     RowBox[{"orbital_", ",", "overtone_"}], "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{"overtone", "+", "orbital", "+", "1"}], ")"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"InsertValues", "[", "expr_", "]"}], ":=", 
    RowBox[{"expr", "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\[Mu]N", "\[Rule]", 
        RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}], ",", " ", 
       RowBox[{"m", "\[Rule]", 
        RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", 
       RowBox[{"\[Eta]", "\[Rule]", 
        RowBox[{"parameters", "[", "\"\<\[Eta]\>\"", "]"}]}], ",", " ", 
       RowBox[{"n", "\[Rule]", 
        RowBox[{"parameters", "[", "\"\<n\>\"", "]"}]}], ",", " ", 
       RowBox[{"l", "\[Rule]", 
        RowBox[{"parameters", "[", "\"\<l\>\"", "]"}]}], ",", " ", 
       RowBox[{"s", "\[Rule]", 
        RowBox[{"parameters", "[", "\"\<s\>\"", "]"}]}], ",", " ", 
       RowBox[{"\[Chi]", "\[Rule]", 
        RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}]}]}], "}"}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GetIngoingSolution", "[", "frobsol_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"inx", "=", 
        RowBox[{
         RowBox[{"MapIndexed", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Re", "[", 
                RowBox[{"#1", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[LessEqual]", "0"}],
               ",", "#2", ",", " ", 
              RowBox[{"Unevaluated", "[", 
               RowBox[{"Sequence", "[", "]"}], "]"}]}], "]"}], "&"}], ",", 
           RowBox[{"frobsol", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}]}], "]"}], "//",
          "First"}]}], "}"}], ",", 
      RowBox[{"frobsol", "[", 
       RowBox[{"[", "inx", "]"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"JfromLS", "[", 
     RowBox[{"l_", ",", "s_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Abs", "[", 
      RowBox[{"l", "+", "s"}], "]"}], "//", 
     RowBox[{
      RowBox[{"Rationalize", "[", 
       RowBox[{"#", ",", "0"}], "]"}], "&"}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Angular", " ", "functions"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"qth", "[", 
      RowBox[{"a_", ",", "\[Nu]_", ",", "\[Theta]_"}], "]"}], ":=", " ", 
     RowBox[{"1", "-", 
      RowBox[{
       SuperscriptBox["a", "2"], "*", 
       SuperscriptBox["\[Nu]", "2"], "*", 
       SuperscriptBox[
        RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Kth", "[", 
      RowBox[{"m_", ",", "a_", ",", "\[Omega]_", ",", "\[Theta]_"}], "]"}], ":=",
      " ", 
     RowBox[{"m", "-", 
      RowBox[{"a", "*", "\[Omega]", "*", 
       SuperscriptBox[
        RowBox[{"Sin", "[", "\[Theta]", "]"}], "2"]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Sigma]", "[", 
      RowBox[{"a_", ",", "m_", ",", "\[Omega]_", ",", "\[Nu]_"}], "]"}], ":=",
      " ", 
     RowBox[{
      RowBox[{"a", "*", 
       SuperscriptBox["\[Nu]", "2"], 
       RowBox[{"(", 
        RowBox[{"m", "-", 
         RowBox[{"a", "*", "\[Omega]"}]}], ")"}]}], " ", "+", " ", 
      "\[Omega]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[CapitalLambda]", "[", 
      RowBox[{
      "a_", ",", "m_", ",", "\[Omega]_", ",", "\[Nu]_", ",", "\[Mu]_"}], 
      "]"}], " ", ":=", " ", 
     RowBox[{
      FractionBox[
       SuperscriptBox["\[Mu]", "2"], 
       SuperscriptBox["\[Nu]", "2"]], "-", 
      FractionBox[
       RowBox[{"\[Sigma]", "[", 
        RowBox[{"a", ",", "m", ",", "\[Omega]", ",", "\[Nu]"}], "]"}], 
       "\[Nu]"], "+", 
      RowBox[{"2", "*", " ", "a", " ", "*", " ", "\[Omega]", "*", "m"}], " ", 
      "-", " ", 
      RowBox[{
       SuperscriptBox["a", "2"], "*", 
       SuperscriptBox["\[Omega]", "2"]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Gamma]", "[", 
      RowBox[{"\[Omega]_", ",", "\[Mu]_"}], "]"}], ":=", " ", 
     RowBox[{
      SuperscriptBox["\[Omega]", "2"], "-", 
      SuperscriptBox["\[Mu]", "2"]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"diffeqang", "[", 
      RowBox[{"s_", ",", "m_", ",", "a_", ",", "\[Omega]_", ",", "\[Nu]_"}], 
      "]"}], ":=", " ", 
     RowBox[{"Collect", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         FractionBox[
          RowBox[{"qth", "[", 
           RowBox[{"a", ",", "\[Nu]", ",", "\[Theta]"}], "]"}], 
          RowBox[{"Sin", "[", "\[Theta]", "]"}]], "*", 
         RowBox[{"D", "[", 
          RowBox[{
           RowBox[{
            FractionBox[
             RowBox[{"Sin", "[", "\[Theta]", "]"}], 
             RowBox[{"qth", "[", 
              RowBox[{"a", ",", "\[Nu]", ",", "\[Theta]"}], "]"}]], "*", 
            RowBox[{"D", "[", 
             RowBox[{"s", ",", "\[Theta]"}], "]"}]}], ",", "\[Theta]"}], 
          "]"}]}], " ", "-", " ", 
        RowBox[{"qth", 
         RowBox[{"(", 
          RowBox[{
           FractionBox[
            SuperscriptBox[
             RowBox[{"Kth", "[", 
              RowBox[{"m", ",", "a", ",", "\[Omega]", ",", "\[Theta]"}], 
              "]"}], "2"], 
            RowBox[{
             RowBox[{"qth", "[", 
              RowBox[{"a", ",", "\[Nu]", ",", "\[Theta]"}], "]"}], "*", 
             SuperscriptBox[
              RowBox[{"Sin", "[", "\[Theta]", "]"}], "2"]}]], "+", 
           RowBox[{
            FractionBox[
             RowBox[{"(", 
              RowBox[{"2", "-", 
               RowBox[{"qth", "[", 
                RowBox[{"a", ",", "\[Nu]", ",", "\[Theta]"}], "]"}]}], ")"}], 
             
             SuperscriptBox[
              RowBox[{"qth", "[", 
               RowBox[{"a", ",", "\[Nu]", ",", "\[Theta]"}], "]"}], "2"]], 
            "*", 
            FractionBox[
             RowBox[{"\[Sigma]", "[", 
              RowBox[{"a", ",", "m", ",", "\[Omega]", ",", "\[Nu]"}], "]"}], 
             "\[Nu]"]}], "-", 
           FractionBox[
            SuperscriptBox["\[Mu]", "2"], 
            SuperscriptBox["\[Nu]", "2"]]}], ")"}], "s"}]}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"s", ",", " ", 
         SuperscriptBox["s", "\[Prime]"], ",", " ", 
         SuperscriptBox["s", "\[Prime]\[Prime]"]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"spherharmons", " ", "=", " ", 
     RowBox[{
      RowBox[{"Flatten", "@", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Row", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"l", ",", "m"}], "}"}], ",", 
            RowBox[{"Spacer", "[", "20", "]"}], ",", 
            RowBox[{"SphericalHarmonicY", "[", 
             RowBox[{"l", ",", "m", ",", "\[Theta]", ",", "0"}], "]"}]}], 
           "}"}], "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"l", ",", "0", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", 
           RowBox[{"-", "l"}], ",", "l"}], "}"}]}], "]"}]}], "//", 
      "MatrixForm"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Off", "[", 
     RowBox[{"ClebschGordan", "::", "tri"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Off", "[", 
     RowBox[{"ClebschGordan", "::", "phy"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dl", "[", "l_", "]"}], ":=", 
    RowBox[{
     RowBox[{"2", "*", "l"}], "+", "1"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sym", "[", 
     RowBox[{"l1_", ",", "l2_", ",", "l3_", ",", "m_"}], "]"}], ":=", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{"-", "1"}], ")"}], "m"], "*", 
     RowBox[{"Sqrt", "[", 
      RowBox[{
       RowBox[{"dl", "[", "l1", "]"}], "*", 
       RowBox[{"dl", "[", "l2", "]"}], "*", 
       FractionBox[
        RowBox[{"dl", "[", "l3", "]"}], 
        RowBox[{"4", "*", "\[Pi]"}]]}], "]"}], "*", 
     RowBox[{"ThreeJSymbol", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"l1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"l2", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"l3", ",", "0"}], "}"}]}], "]"}], "*", 
     RowBox[{"ThreeJSymbol", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"l1", ",", 
         RowBox[{"-", "m"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"l2", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"l3", ",", "m"}], "}"}]}], "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"all", "[", 
     RowBox[{"l_", ",", "lp_", ",", "m_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      FractionBox["4", "3"], 
      RowBox[{"Sqrt", "[", " ", 
       FractionBox["\[Pi]", "5"], "]"}], 
      RowBox[{"sym", "[", 
       RowBox[{"l", ",", "2", ",", "lp", ",", "m"}], "]"}]}], " ", "+", " ", 
     RowBox[{
      FractionBox[
       RowBox[{"Sqrt", "[", 
        RowBox[{"4", "*", "\[Pi]"}], "]"}], "3"], "*", 
      RowBox[{"sym", "[", 
       RowBox[{"l", ",", "0", ",", "lp", ",", "m"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"bll", "[", 
     RowBox[{"l_", ",", "lp_", ",", "m_"}], "]"}], ":=", " ", 
    RowBox[{
     RowBox[{"2", "*", 
      FractionBox[
       RowBox[{"Sqrt", "[", "\[Pi]", "]"}], "5"], "*", 
      RowBox[{"sym", "[", 
       RowBox[{"l", ",", "0", ",", "lp", ",", "m"}], "]"}]}], " ", "+", " ", 
     RowBox[{"8", "*", 
      FractionBox[
       RowBox[{"Sqrt", "[", 
        FractionBox["\[Pi]", "5"], "]"}], "7"], 
      RowBox[{"sym", "[", 
       RowBox[{"l", ",", "2", ",", "lp", ",", "m"}], "]"}]}], " ", "+", " ", 
     RowBox[{"16", "*", 
      FractionBox[
       RowBox[{"Sqrt", "[", "\[Pi]", "]"}], "105"], "*", 
      RowBox[{"sym", "[", 
       RowBox[{"l", ",", "4", ",", "lp", ",", "m"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dll", "[", 
     RowBox[{"l_", ",", "lp_", ",", "m_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"Sqrt", "[", 
      RowBox[{"4", 
       FractionBox["\[Pi]", "3"]}], "]"}], 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"lp", "*", 
        FractionBox[
         RowBox[{"Sqrt", "[", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"lp", "+", "1"}], ")"}], "2"], "-", 
           SuperscriptBox["m", "2"]}], "]"}], 
         RowBox[{"Sqrt", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"2", "lp"}], "+", "1"}], ")"}], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"2", "lp"}], "+", "3"}], ")"}]}], "]"}]], "*", 
        RowBox[{"sym", "[", 
         RowBox[{"l", ",", "1", ",", 
          RowBox[{"lp", "+", "1"}], ",", "m"}], "]"}]}], " ", "-", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"lp", "+", "1"}], ")"}], 
        FractionBox[
         RowBox[{"Sqrt", "[", 
          RowBox[{
           SuperscriptBox["lp", "2"], "-", 
           SuperscriptBox["m", "2"]}], "]"}], 
         RowBox[{"Sqrt", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"2", "lp"}], "+", "1"}], ")"}], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"2", "lp"}], "-", "1"}], ")"}]}], "]"}]], "*", 
        RowBox[{"sym", "[", 
         RowBox[{"l", ",", "1", ",", 
          RowBox[{"lp", "-", "1"}], ",", "m"}], "]"}]}]}], ")"}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Mmatrixdef", "[", 
     RowBox[{
     "l_", ",", "lp_", ",", "m_", ",", "a_", ",", "\[Omega]_", ",", "\[Nu]_", 
      ",", "\[Mu]_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[CapitalLambda]", "[", 
         RowBox[{"a", ",", "m", ",", "\[Omega]", ",", "\[Nu]", ",", "\[Mu]"}],
          "]"}], " ", "-", " ", 
        RowBox[{"lp", "*", 
         RowBox[{"(", 
          RowBox[{"lp", "+", "1"}], ")"}]}]}], ")"}], "*", 
      RowBox[{"KroneckerDelta", "[", 
       RowBox[{"l", ",", "lp"}], "]"}]}], "  ", "+", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"-", 
          SuperscriptBox["\[Nu]", "2"]}], "*", 
         RowBox[{"\[CapitalLambda]", "[", 
          RowBox[{
          "a", ",", "m", ",", "\[Omega]", ",", "\[Nu]", ",", "\[Mu]"}], 
          "]"}]}], " ", "+", " ", 
        RowBox[{
         SuperscriptBox["\[Nu]", "2"], "*", "lp", "*", 
         RowBox[{"(", 
          RowBox[{"lp", "+", "1"}], ")"}]}], " ", "-", " ", 
        RowBox[{"2", "*", 
         RowBox[{"\[Sigma]", "[", 
          RowBox[{"a", ",", "m", ",", "\[Omega]", ",", "\[Nu]"}], "]"}], "*", 
         "\[Nu]"}], "+", 
        RowBox[{"\[Gamma]", "[", 
         RowBox[{"\[Omega]", ",", "\[Mu]"}], "]"}]}], ")"}], 
      SuperscriptBox["a", "2"], "*", 
      RowBox[{"all", "[", 
       RowBox[{"l", ",", "lp", ",", "m"}], "]"}]}], " ", "-", " ", 
     RowBox[{"2", "*", 
      SuperscriptBox["a", "2"], "*", 
      SuperscriptBox["\[Nu]", "2"], "*", 
      RowBox[{"dll", "[", 
       RowBox[{"l", ",", "lp", ",", "m"}], "]"}]}], " ", "-", " ", 
     RowBox[{
      RowBox[{"\[Gamma]", "[", 
       RowBox[{"\[Omega]", ",", "\[Mu]"}], "]"}], "*", 
      SuperscriptBox["\[Nu]", "2"], "*", 
      SuperscriptBox["a", "4"], "*", 
      RowBox[{"bll", "[", 
       RowBox[{"l", ",", "lp", ",", "m"}], "]"}]}]}]}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Mmatrix", "[", 
     RowBox[{
     "KMax_", ",", "eta_", ",", "m_", ",", "a_", ",", "\[Omega]_", ",", 
      "\[Nu]_", ",", "\[Mu]_"}], "]"}], ":=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"Mmatrixdef", "[", 
       RowBox[{
        RowBox[{"m", "+", 
         RowBox[{"2", "*", "k"}], "+", "eta"}], ",", 
        RowBox[{"m", "+", 
         RowBox[{"2", "*", "kp"}], "+", "eta"}], ",", "m", ",", "a", ",", 
        "\[Omega]", ",", "\[Nu]", ",", "\[Mu]"}], "]"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"k", ",", "0", ",", "KMax"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"kp", ",", "0", ",", "KMax"}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ansatz", "[", "b1_", "]"}], ":=", " ", 
     RowBox[{"{", 
      RowBox[{"1", ",", " ", "b1", ",", "0"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Radial", " ", "functions"}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"qr", "[", 
      RowBox[{"\[Nu]_", ",", "r_"}], "]"}], ":=", " ", 
     RowBox[{"1", "+", 
      RowBox[{
       SuperscriptBox["\[Nu]", "2"], "*", 
       SuperscriptBox["r", "2"]}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Sigma]", "[", 
      RowBox[{"a_", ",", "m_", ",", "\[Omega]_", ",", "\[Nu]_"}], "]"}], ":=",
      " ", 
     RowBox[{
      RowBox[{"a", "*", 
       SuperscriptBox["\[Nu]", "2"], 
       RowBox[{"(", 
        RowBox[{"m", "-", 
         RowBox[{"a", "*", "\[Omega]"}]}], ")"}]}], " ", "+", " ", 
      "\[Omega]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Kr", "[", 
      RowBox[{"a_", ",", "m_", ",", "r_"}], "]"}], ":=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "a"}], "*", "m"}], " ", "+", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["a", "2"], "+", 
         SuperscriptBox["r", "2"]}], ")"}], "\[Omega]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rplus", " ", "=", " ", 
     FractionBox[
      RowBox[{"(", 
       RowBox[{"rs", " ", "+", " ", 
        RowBox[{"Sqrt", "[", 
         RowBox[{
          SuperscriptBox["rs", "2"], "-", 
          RowBox[{"4", "*", 
           SuperscriptBox["a", "2"]}]}], "]"}]}], ")"}], "2"]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rminus", " ", "=", " ", 
     FractionBox[
      RowBox[{"(", 
       RowBox[{"rs", " ", "-", " ", 
        RowBox[{"Sqrt", "[", 
         RowBox[{
          SuperscriptBox["rs", "2"], "-", 
          RowBox[{"4", "*", 
           SuperscriptBox["a", "2"]}]}], "]"}]}], ")"}], "2"]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[CapitalDelta]", " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"r", "-", "rplus"}], ")"}], 
      RowBox[{"(", 
       RowBox[{"r", "-", "rminus"}], ")"}]}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"diffeqrad", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"D", "[", 
        RowBox[{
         RowBox[{
          FractionBox["\[CapitalDelta]", "qr"], "*", 
          RowBox[{"D", "[", 
           RowBox[{
            RowBox[{"R", "[", "r", "]"}], ",", "r"}], "]"}]}], ",", "r"}], 
        "]"}], " ", "+", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          FractionBox[
           SuperscriptBox[
            RowBox[{"Kr", "[", 
             RowBox[{"a", ",", "m", ",", "r"}], "]"}], "2"], 
           RowBox[{"qr", "*", "\[CapitalDelta]"}]], "+", 
          RowBox[{
           FractionBox[
            RowBox[{"(", 
             RowBox[{"2", "-", "qr"}], ")"}], 
            SuperscriptBox["qr", "2"]], "*", 
           FractionBox[
            RowBox[{"\[Sigma]", "[", 
             RowBox[{"a", ",", "m", ",", "\[Omega]", ",", "\[Nu]"}], "]"}], 
            "\[Nu]"]}], "-", 
          FractionBox[
           SuperscriptBox["\[Mu]", "2"], 
           SuperscriptBox["\[Nu]", "2"]]}], ")"}], 
        RowBox[{"R", "[", "r", "]"}]}]}], "\[Equal]", "0"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"diffeqradOp", " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{
           FractionBox["\[CapitalDelta]", "qr"], "*", 
           RowBox[{"D", "[", 
            RowBox[{"#", ",", "r"}], "]"}]}], ",", "r"}], "]"}], " ", "+", 
        " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           FractionBox[
            SuperscriptBox[
             RowBox[{"Kr", "[", 
              RowBox[{"a", ",", "m", ",", "r"}], "]"}], "2"], 
            RowBox[{"qr", "*", "\[CapitalDelta]"}]], "+", 
           RowBox[{
            FractionBox[
             RowBox[{"(", 
              RowBox[{"2", "-", "qr"}], ")"}], 
             SuperscriptBox["qr", "2"]], "*", 
            FractionBox[
             RowBox[{"\[Sigma]", "[", 
              RowBox[{"a", ",", "m", ",", "\[Omega]", ",", "\[Nu]"}], "]"}], 
             "\[Nu]"]}], "-", 
           FractionBox[
            SuperscriptBox["\[Mu]", "2"], 
            SuperscriptBox["\[Nu]", "2"]]}], ")"}], "#"}]}], ")"}], "&"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[CapitalKappa]", "[", 
     RowBox[{"\[Omega]_", ",", "\[Chi]_", ",", "m_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"\[Omega]", "*", 
        RowBox[{"rplusN", "[", "\[Chi]", "]"}], "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"rplusN", "[", "\[Chi]", "]"}], "+", 
          RowBox[{"rminusN", "[", "\[Chi]", "]"}]}], ")"}]}], " ", "-", " ", 
       RowBox[{"\[Chi]", "*", "m"}]}], ")"}], "/", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"rplusN", "[", "\[Chi]", "]"}], "-", 
       RowBox[{"rminusN", "[", "\[Chi]", "]"}]}], ")"}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rplusN", "[", "\[Chi]_", "]"}], ":=", 
    RowBox[{
     RowBox[{"1", " ", "+", " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"1", "-", 
         SuperscriptBox["\[Chi]", "2"]}], ")"}], 
       FractionBox["1", "2"]]}], "//", "ToPrecision"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rminusN", "[", "\[Chi]_", "]"}], ":=", 
    RowBox[{
     RowBox[{"1", " ", "-", " ", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"1", "-", 
         SuperscriptBox["\[Chi]", "2"]}], ")"}], 
       FractionBox["1", "2"]]}], "//", "ToPrecision"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"KerrSurfaceRotationN", "[", "\[Chi]_", "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "/", "2"}], ")"}], 
      RowBox[{"(", 
       RowBox[{"\[Chi]", "/", 
        RowBox[{"rplusN", "[", "\[Chi]", "]"}]}], ")"}]}], "//", 
     "ToPrecision"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"omegaNRNonRel", "[", 
     RowBox[{"parameters_", ":", "parameters"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Mu]N", "=", 
         RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}], ",", 
        RowBox[{"m", "=", 
         RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", " ", 
        RowBox[{"l", "=", 
         RowBox[{"parameters", "[", "\"\<l\>\"", "]"}]}], ",", 
        RowBox[{"n", "=", 
         RowBox[{"parameters", "[", "\"\<n\>\"", "]"}]}], ",", 
        RowBox[{"s", "=", 
         RowBox[{"parameters", "[", "\"\<s\>\"", "]"}]}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"\[Mu]N", "*", 
        RowBox[{"(", 
         RowBox[{"1", " ", "-", " ", 
          RowBox[{
           SuperscriptBox["\[Mu]N", "2"], "/", 
           RowBox[{"(", 
            RowBox[{"2", "*", 
             SuperscriptBox[
              RowBox[{"TotalQuantum", "[", 
               RowBox[{"l", ",", "n"}], "]"}], "2"]}], ")"}]}]}], ")"}]}], "//", 
       RowBox[{
        RowBox[{"Rationalize", "[", 
         RowBox[{"#", ",", "0"}], "]"}], "&"}]}]}], "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gfuncN", "[", 
     RowBox[{"j_", ",", 
      RowBox[{"parameters_", ":", "parameters"}]}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Chi]", "=", 
         RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}]}], ",", 
        RowBox[{"\[Mu]N", "=", 
         RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}], ",", 
        RowBox[{"m", "=", 
         RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", " ", 
        RowBox[{"l", "=", 
         RowBox[{"parameters", "[", "\"\<l\>\"", "]"}]}], ",", 
        RowBox[{"n", "=", 
         RowBox[{"parameters", "[", "\"\<n\>\"", "]"}]}], ",", 
        RowBox[{"s", "=", 
         RowBox[{"parameters", "[", "\"\<s\>\"", "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Product", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           SuperscriptBox["k", "2"], "*", 
           RowBox[{"(", 
            RowBox[{"1", "-", 
             SuperscriptBox["\[Chi]", "2"]}], ")"}]}], " ", "+", " ", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             RowBox[{"\[Chi]", "*", "m"}], " ", "-", " ", 
             RowBox[{"2", "*", 
              RowBox[{"rplusN", "[", "\[Chi]", "]"}], "*", 
              RowBox[{"omegaNRNonRel", "[", "parameters", "]"}]}]}], ")"}], 
           "2"]}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "j"}], "}"}]}], "]"}], "//", 
       RowBox[{
        RowBox[{"Rationalize", "[", 
         RowBox[{"#", ",", "0"}], "]"}], "&"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Ccoeff", "[", 
     RowBox[{"n_", ",", "l_", ",", "j_"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"NN", " ", "=", " ", 
        RowBox[{"n", "+", "l", "+", "1"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"NN", "\[GreaterEqual]", "0"}], ",", "\[IndentingNewLine]", 
        " ", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              SuperscriptBox["2", 
               RowBox[{
                RowBox[{"2", "l"}], "+", 
                RowBox[{"2", "j"}], "+", "1"}]], "*", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"NN", "+", "l"}], ")"}], "!"}]}], ")"}], "/", 
            RowBox[{"(", 
             RowBox[{
              SuperscriptBox["NN", 
               RowBox[{
                RowBox[{"2", "l"}], "+", "4"}]], "*", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"NN", "-", "l", "-", "1"}], ")"}], "!"}]}], ")"}]}], 
           ")"}], 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             RowBox[{"l", "!"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"l", "+", "j"}], ")"}], "!"}], 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"l", "+", "j", "+", "1"}], ")"}], "!"}]}], ")"}]}], 
            ")"}], "2"], "*", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"1", " ", "+", " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"2", 
                RowBox[{"(", 
                 RowBox[{"1", "+", "l", "-", "j"}], ")"}], 
                RowBox[{"(", 
                 RowBox[{"1", "-", "l", "+", "j"}], ")"}]}], ")"}], "/", 
              RowBox[{"(", 
               RowBox[{"l", "+", "j"}], ")"}]}]}], ")"}], "2"]}], "//", 
         "Rationalize"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<Error: Principal quantum number less than zero!\>\"", "]"}], 
         ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"omegaNINonRel", "[", 
     RowBox[{"parameters_", ":", "parameters"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Chi]", "=", 
         RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}]}], ",", 
        RowBox[{"\[Mu]N", "=", 
         RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}], ",", 
        RowBox[{"m", "=", 
         RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", 
        RowBox[{"l", "=", 
         RowBox[{"parameters", "[", "\"\<l\>\"", "]"}]}], ",", 
        RowBox[{"n", "=", 
         RowBox[{"parameters", "[", "\"\<n\>\"", "]"}]}], ",", 
        RowBox[{"s", "=", 
         RowBox[{"parameters", "[", "\"\<s\>\"", "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"j", "=", 
          RowBox[{"Abs", "[", "m", "]"}]}], "}"}], ",", 
        RowBox[{"2", "*", 
         RowBox[{"rplusN", "[", "\[Chi]", "]"}], "*", 
         RowBox[{"Ccoeff", "[", 
          RowBox[{"n", ",", "l", ",", "j"}], "]"}], "*", 
         RowBox[{"gfuncN", "[", 
          RowBox[{"j", ",", "parameters"}], "]"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"m", "*", 
            RowBox[{"KerrSurfaceRotationN", "[", "\[Chi]", "]"}]}], " ", "-", 
           " ", 
           RowBox[{"omegaNRNonRel", "[", "parameters", "]"}]}], ")"}], "*", 
         SuperscriptBox["\[Mu]N", 
          RowBox[{
           RowBox[{"2", "l"}], "+", 
           RowBox[{"2", "j"}], "+", "5"}]]}]}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nuNNonRel", "[", 
     RowBox[{"parameters_", ":", "parameters"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Chi]", "=", 
         RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}]}], ",", " ", 
        RowBox[{"\[Mu]N", "=", 
         RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}], ",", 
        RowBox[{"m", "=", 
         RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", 
        RowBox[{"l", "=", 
         RowBox[{"parameters", "[", "\"\<l\>\"", "]"}]}], ",", 
        RowBox[{"n", "=", 
         RowBox[{"parameters", "[", "\"\<n\>\"", "]"}]}], ",", " ", 
        RowBox[{"PolarizationSigned", "=", 
         RowBox[{"parameters", "[", "\"\<s\>\"", "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Omega]NNonRel", " ", "=", " ", 
          RowBox[{
           RowBox[{"omegaNRNonRel", "[", "parameters", "]"}], " ", "+", " ", 
           RowBox[{
            RowBox[{"omegaNINonRel", "[", "parameters", "]"}], "*", "I"}]}]}],
          "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Evaluate", "@", 
         RowBox[{"Switch", "[", 
          RowBox[{"PolarizationSigned", ",", "\[IndentingNewLine]", 
           RowBox[{"-", "1"}], ",", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"-", "\[Omega]NNonRel"}], ")"}], "/", 
            RowBox[{"(", 
             RowBox[{"m", "-", 
              RowBox[{"\[Chi]", "*", "\[Omega]NNonRel"}]}], ")"}]}], ",", 
           "\[IndentingNewLine]", "0", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "/", 
              RowBox[{"(", 
               RowBox[{"2", "*", "\[Chi]"}], ")"}]}], ")"}], 
            RowBox[{"(", 
             RowBox[{"m", "+", "1", "-", 
              RowBox[{"\[Chi]", "*", "\[Omega]NNonRel"}], "+", 
              RowBox[{"\[Sqrt]", 
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"\[Chi]", "*", "\[Omega]NNonRel"}], " ", "-", " ",
                     "m", " ", "-", " ", "1"}], ")"}], "2"], "+", 
                 RowBox[{"4", "*", "\[Chi]", "*", "\[Omega]NNonRel"}]}], 
                ")"}]}]}], ")"}]}], ",", "\[IndentingNewLine]", "1", ",", 
           RowBox[{"Evaluate", "@", 
            RowBox[{"Block", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"X", "=", "\[Chi]"}], ",", "\[Nu]"}], "}"}], ",", 
              RowBox[{
               RowBox[{"Roots", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"X", "*", 
                    SuperscriptBox["\[Nu]", "3"], 
                    RowBox[{"(", 
                    RowBox[{"m", " ", "-", " ", 
                    RowBox[{"X", "*", "\[Omega]NNonRel"}]}], ")"}]}], "-", 
                   RowBox[{
                    SuperscriptBox["\[Nu]", "2"], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"m", "+", "1"}], ")"}], 
                    RowBox[{"(", 
                    RowBox[{"m", "+", "2"}], ")"}]}], " ", "-", " ", 
                    RowBox[{"X", "*", "\[Omega]NNonRel", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", "m"}], "-", 
                    RowBox[{"X", "*", "\[Omega]NNonRel"}]}], ")"}]}]}], 
                    ")"}]}], " ", "+", " ", 
                   RowBox[{"\[Omega]NNonRel", "*", "\[Nu]"}], " ", "+", " ", 
                   SuperscriptBox["\[Omega]NNonRel", "2"]}], "\[Equal]", 
                  "0"}], ",", "\[Nu]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}]}]}], "]"}]}], "]"}]}], " ", 
   RowBox[{"(*", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Chi]", "=", "X"}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Roots", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"\[Chi]", "*", 
             SuperscriptBox["\[Nu]", "3"], 
             RowBox[{"(", 
              RowBox[{"m", " ", "-", " ", 
               RowBox[{"\[Chi]", "*", "\[Omega]NNonRel"}]}], ")"}]}], "-", 
            RowBox[{
             SuperscriptBox["\[Nu]", "2"], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"m", "+", "1"}], ")"}], 
                RowBox[{"(", 
                 RowBox[{"m", "+", "2"}], ")"}]}], " ", "-", " ", 
               RowBox[{"\[Chi]", "*", "\[Omega]NNonRel", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"2", "m"}], "-", 
                  RowBox[{"\[Chi]", "*", "\[Omega]NNonRel"}]}], ")"}]}]}], 
              ")"}]}], " ", "+", " ", 
            RowBox[{"\[Omega]NNonRel", "*", "\[Nu]"}], " ", "+", " ", 
            SuperscriptBox["\[Omega]NNonRel", "2"]}], "\[Equal]", "0"}], ",", 
          "\[Nu]"}], "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], "//", "Simplify"}]}], "]"}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nuNNonRel", "[", 
     RowBox[{"\[Omega]NNonRel_", ",", 
      RowBox[{"parameters_", ":", "parameters"}]}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Chi]", "=", 
         RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}]}], ",", 
        RowBox[{"m", "=", 
         RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", " ", 
        RowBox[{"PolarizationSigned", "=", 
         RowBox[{"parameters", "[", "\"\<s\>\"", "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Evaluate", "@", 
       RowBox[{"Switch", "[", 
        RowBox[{"PolarizationSigned", ",", "\[IndentingNewLine]", 
         RowBox[{"-", "1"}], ",", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"-", "\[Omega]NNonRel"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"m", "-", 
            RowBox[{"\[Chi]", "*", "\[Omega]NNonRel"}]}], ")"}]}], ",", 
         "\[IndentingNewLine]", "0", ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "/", 
            RowBox[{"(", 
             RowBox[{"2", "*", "\[Chi]"}], ")"}]}], ")"}], 
          RowBox[{"(", 
           RowBox[{"m", "+", "1", "-", 
            RowBox[{"\[Chi]", "*", "\[Omega]NNonRel"}], "+", 
            RowBox[{"\[Sqrt]", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"\[Chi]", "*", "\[Omega]NNonRel"}], " ", "-", " ", 
                  "m", " ", "-", " ", "1"}], ")"}], "2"], "+", 
               RowBox[{"4", "*", "\[Chi]", "*", "\[Omega]NNonRel"}]}], 
              ")"}]}]}], ")"}]}], ",", "\[IndentingNewLine]", "1", ",", 
         RowBox[{"Evaluate", "@", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"X", "=", "\[Chi]"}], ",", "\[Nu]"}], "}"}], ",", 
            RowBox[{
             RowBox[{"Roots", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"X", "*", 
                  SuperscriptBox["\[Nu]", "3"], 
                  RowBox[{"(", 
                   RowBox[{"m", " ", "-", " ", 
                    RowBox[{"X", "*", "\[Omega]NNonRel"}]}], ")"}]}], "-", 
                 RowBox[{
                  SuperscriptBox["\[Nu]", "2"], 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"m", "+", "1"}], ")"}], 
                    RowBox[{"(", 
                    RowBox[{"m", "+", "2"}], ")"}]}], " ", "-", " ", 
                    RowBox[{"X", "*", "\[Omega]NNonRel", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", "m"}], "-", 
                    RowBox[{"X", "*", "\[Omega]NNonRel"}]}], ")"}]}]}], 
                   ")"}]}], " ", "+", " ", 
                 RowBox[{"\[Omega]NNonRel", "*", "\[Nu]"}], " ", "+", " ", 
                 SuperscriptBox["\[Omega]NNonRel", "2"]}], "\[Equal]", "0"}], 
               ",", "\[Nu]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Mmatrixdettemp", "=", " ", 
     RowBox[{"Evaluate", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            SuperscriptBox["\[Nu]N", "KMax"], "*", 
            RowBox[{"Mmatrix", "[", 
             RowBox[{
             "KMax", ",", "eta", ",", "m", ",", "a", ",", "\[Omega]", ",", 
              "\[Nu]", ",", "\[Mu]"}], "]"}]}], "//", "Det"}], "//", 
          "Refine"}], "//", 
         RowBox[{
          RowBox[{"Collect", "[", 
           RowBox[{"#", ",", "M"}], "]"}], "&"}]}], "//", 
        RowBox[{
         RowBox[{"Collect", "[", 
          RowBox[{"#", ",", "\[Nu]N"}], "]"}], "&"}]}], "//", "Refine"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Mmatrixdet", "[", 
      RowBox[{"\[Omega]N_", ",", "\[Nu]N_", ",", " ", 
       RowBox[{"parameters_", ":", "parameters"}]}], "]"}], ":=", 
     RowBox[{"Evaluate", "@", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"eta", "=", 
           RowBox[{"parameters", "[", "\"\<\[Eta]\>\"", "]"}]}], ",", 
          RowBox[{"m", "=", 
           RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", 
          RowBox[{"\[Chi]", "=", 
           RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}]}], ",", 
          RowBox[{"\[Mu]N", "=", 
           RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}]}], "}"}], 
        ",", 
        RowBox[{"Evaluate", "@", "Mmatrixdettemp"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"getNuValue", "[", 
     RowBox[{
      RowBox[{"\[Omega]N_", "?", "NumberQ"}], ",", 
      RowBox[{"parameters_", ":", "parameters"}], ",", 
      RowBox[{"ClosestGuess_", "?", "NumberQ"}]}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"eta", "=", 
         RowBox[{"parameters", "[", "\"\<\[Eta]\>\"", "]"}]}], ",", 
        RowBox[{"m", "=", 
         RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", 
        RowBox[{"\[Chi]", "=", 
         RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}]}], ",", 
        RowBox[{"\[Mu]N", "=", 
         RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"thedet", " ", "=", " ", 
          RowBox[{"Mmatrixdet", "[", 
           RowBox[{"w", ",", "n", ",", "parameters"}], "]"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"massageddet", " ", "=", " ", 
            RowBox[{
             RowBox[{"(", "thedet", ")"}], "/.", 
             RowBox[{"w", "\[Rule]", "\[Omega]N"}]}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"FindRoot", "[", 
               RowBox[{
                RowBox[{"massageddet", "//", "ToPrecision"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", ",", "ClosestGuess"}], "}"}], ",", " ", 
                RowBox[{"WorkingPrecision", "\[Rule]", "precision"}]}], "]"}],
               "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "//", 
            RowBox[{
             RowBox[{"Rationalize", "[", 
              RowBox[{"#", ",", "0"}], "]"}], "&"}]}], "//", "Return"}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], 
   RowBox[{"(*", 
    RowBox[{"Min", "@", 
     RowBox[{"Cases", "[", 
      RowBox[{"%", ",", 
       RowBox[{
        RowBox[{"Power", "[", 
         RowBox[{"\[Nu]N", ",", 
          RowBox[{"x_", "?", "NumberQ"}]}], "]"}], "\[RuleDelayed]", "x"}], 
       ",", 
       RowBox[{"-", "1"}]}], "]"}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"qrN", " ", "=", " ", 
     RowBox[{"qr", "[", 
      RowBox[{"\[Nu]", ",", 
       RowBox[{"rN", "*", "M"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rpN", " ", "=", " ", 
     RowBox[{
      RowBox[{"rplusN", "[", "\[Chi]", "]"}], "//", "Rationalize"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rmN", " ", "=", " ", 
     RowBox[{
      RowBox[{"rminusN", "[", "\[Chi]", "]"}], "//", "Rationalize"}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"rsN", " ", "=", " ", 
     RowBox[{
      RowBox[{"rpN", "+", "rmN"}], "//", "Rationalize"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[CapitalDelta]N", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"rN", " ", "-", " ", "rpN"}], ")"}], "*", 
       RowBox[{"(", 
        RowBox[{"rN", "-", "rmN"}], ")"}]}], "//", "Rationalize"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Sigma]N", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"\[Sigma]", "[", 
         RowBox[{"a", ",", "m", ",", "\[Omega]", ",", "\[Nu]"}], "]"}], "*", 
        "M"}], "//", "Expand"}], "//", "Rationalize"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"KrN", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Kr", "[", 
         RowBox[{"a", ",", "m", ",", 
          RowBox[{"rN", "*", "M"}]}], "]"}], "/", "M"}], "//", 
       "Rationalize"}], "//", "Simplify"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"qrNX", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"qrN", "/.", 
        RowBox[{"rN", "\[Rule]", 
         RowBox[{"xN", " ", "+", " ", 
          RowBox[{"rplusN", "[", "\[Chi]", "]"}]}]}]}], "//", "Rationalize"}],
       "//", "FullSimplify"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"KrNX", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"KrN", "/.", 
        RowBox[{"rN", "\[Rule]", 
         RowBox[{"xN", " ", "+", " ", 
          RowBox[{"rplusN", "[", "\[Chi]", "]"}]}]}]}], "//", "Rationalize"}],
       "//", "FullSimplify"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Sigma]NX", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Sigma]N", "/.", 
        RowBox[{"rN", "\[Rule]", 
         RowBox[{"xN", "+", 
          RowBox[{"rplusN", "[", "\[Chi]", "]"}]}]}]}], "//", "Rationalize"}],
       "//", "FullSimplify"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[CapitalDelta]NX", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"\[CapitalDelta]N", "/.", 
        RowBox[{"rN", "\[Rule]", 
         RowBox[{"xN", "+", 
          RowBox[{"rplusN", "[", "\[Chi]", "]"}]}]}]}], "//", "Rationalize"}],
       "//", "FullSimplify"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DiffRadOp", " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         SubscriptBox["\[PartialD]", 
          RowBox[{"rN", ",", "rN"}]], "#"}], " ", "+", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"qrN", "/", "\[CapitalDelta]N"}], ")"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"2", "rN"}], "-", "rsN"}], ")"}], "/", "qrN"}], "-", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"2", "rN", "*", 
              SuperscriptBox["\[Nu]N", "2"], "*", "\[CapitalDelta]N"}], ")"}],
             "/", 
            SuperscriptBox["qrN", "2"]}]}], ")"}], 
         RowBox[{
          SubscriptBox["\[PartialD]", "rN"], "#"}]}], " ", "+", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"qrN", "/", "\[CapitalDelta]N"}], ")"}], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"\[Mu]N", "/", "\[Nu]N"}], ")"}], "2"]}], "+", 
           RowBox[{
            SuperscriptBox["KrN", "2"], "/", 
            RowBox[{"(", 
             RowBox[{"\[CapitalDelta]N", "*", "qrN"}], ")"}]}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"2", "-", "qrN"}], ")"}], "/", 
              SuperscriptBox["qrN", "2"]}], ")"}], "*", 
            RowBox[{"(", 
             RowBox[{"\[Sigma]N", "/", "\[Nu]N"}], ")"}]}]}], ")"}], "#"}]}], 
       ")"}], "&"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"P1", " ", "=", " ", 
     RowBox[{
      FractionBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"2", "*", "rN"}], " ", "-", " ", "rsN"}], ")"}], 
       RowBox[{"rN", "-", 
        RowBox[{"rminusN", "[", "\[Chi]", "]"}]}]], "//", "Rationalize"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"P2", " ", "=", " ", 
     FractionBox[
      RowBox[{"-", 
       RowBox[{"(", 
        RowBox[{"2", "*", "rN", "*", 
         SuperscriptBox["\[Nu]N", "2"]}], ")"}]}], "qrN"]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Q1", " ", "=", " ", 
     FractionBox[
      SuperscriptBox["KrN", "2"], 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"rN", "-", 
         RowBox[{"rminusN", "[", "\[Chi]", "]"}]}], ")"}], "2"]]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Q2", " ", "=", " ", 
     RowBox[{
      RowBox[{
       FractionBox["qrN", 
        RowBox[{"(", 
         RowBox[{"rN", "-", 
          RowBox[{"rminusN", "[", "\[Chi]", "]"}]}], ")"}]], "*", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          FractionBox[
           RowBox[{"(", 
            RowBox[{"2", "-", "qrN"}], ")"}], 
           SuperscriptBox["qrN", "2"]], "*", 
          FractionBox["\[Sigma]N", "\[Nu]N"]}], "-", 
         FractionBox[
          SuperscriptBox["\[Mu]N", "2"], 
          SuperscriptBox["\[Nu]N", "2"]]}], ")"}]}], "//", "Rationalize"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"P1x", " ", "=", " ", 
     RowBox[{"P1", "/.", 
      RowBox[{"rN", "\[Rule]", 
       RowBox[{
        RowBox[{"xN", "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"rplusN", "[", "\[Chi]", "]"}], "-", 
           RowBox[{"rminusN", "[", "\[Chi]", "]"}]}], ")"}]}], "+", 
        RowBox[{"rplusN", "[", "\[Chi]", "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"P2x", " ", "=", " ", 
     RowBox[{"P2", "/.", 
      RowBox[{"rN", "\[Rule]", 
       RowBox[{
        RowBox[{"xN", "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"rplusN", "[", "\[Chi]", "]"}], "-", 
           RowBox[{"rminusN", "[", "\[Chi]", "]"}]}], ")"}]}], "+", 
        RowBox[{"rplusN", "[", "\[Chi]", "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Q1x", " ", "=", " ", 
     RowBox[{"Q1", "/.", 
      RowBox[{"rN", "\[Rule]", 
       RowBox[{
        RowBox[{"xN", "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"rplusN", "[", "\[Chi]", "]"}], "-", 
           RowBox[{"rminusN", "[", "\[Chi]", "]"}]}], ")"}]}], "+", 
        RowBox[{"rplusN", "[", "\[Chi]", "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Q2x", " ", "=", " ", 
     RowBox[{"Q2", "/.", 
      RowBox[{"rN", "\[Rule]", 
       RowBox[{
        RowBox[{"xN", "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"rplusN", "[", "\[Chi]", "]"}], "-", 
           RowBox[{"rminusN", "[", "\[Chi]", "]"}]}], ")"}]}], "+", 
        RowBox[{"rplusN", "[", "\[Chi]", "]"}]}]}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DiffRadOpx", " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         SubscriptBox["\[PartialD]", 
          RowBox[{"xN", ",", "xN"}]], "#"}], " ", "+", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"P1x", "/", "xN"}], "+", 
           RowBox[{"P2x", "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"rplusN", "[", "\[Chi]", "]"}], "-", 
              RowBox[{"rminusN", "[", "\[Chi]", "]"}]}], ")"}]}]}], ")"}], 
         RowBox[{
          SubscriptBox["\[PartialD]", "xN"], "#"}]}], " ", "+", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Q1x", "/", 
            SuperscriptBox["xN", "2"]}], "+", 
           RowBox[{"Q2x", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"rplusN", "[", "\[Chi]", "]"}], "-", 
               RowBox[{"rminusN", "[", "\[Chi]", "]"}]}], ")"}], "/", 
             "xN"}]}]}], ")"}], "#"}]}], ")"}], "&"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FrobeniusSeries", "[", 
     RowBox[{"x_", ",", "\[Kappa]_", ",", "c1_", ",", "c2_"}], "]"}], ":=", 
    RowBox[{
     SuperscriptBox["x", 
      RowBox[{
       RowBox[{"-", "I"}], "*", "\[Kappa]"}]], "*", 
     RowBox[{"(", 
      RowBox[{"1", " ", "+", " ", 
       RowBox[{"c1", "*", "x"}], " ", "+", " ", 
       RowBox[{"c2", "*", 
        SuperscriptBox["x", "2"]}]}], ")"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"FrobeniusSeries", "[", 
      RowBox[{"xN", ",", "\[Kappa]", ",", 
       RowBox[{"C", "[", "1", "]"}], ",", 
       RowBox[{"C", "[", "2", "]"}]}], "]"}], ";", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox["xN", 
         RowBox[{
          RowBox[{"I", "*", "\[Kappa]"}], "+", "2"}]], 
        RowBox[{"DiffRadOpx", "@", "%"}]}], ")"}], "//", "Simplify"}], ";", 
     " ", 
     RowBox[{
      RowBox[{"Series", "[", 
       RowBox[{"%", ",", " ", 
        RowBox[{"{", 
         RowBox[{"xN", ",", "0", ",", "2"}], "}"}]}], "]"}], "\[Equal]", 
      "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"FrobeniusSystem", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Simplify", "[", 
         RowBox[{
          RowBox[{"LogicalExpand", "[", "%", "]"}], ",", " ", 
          RowBox[{"TimeConstraint", "\[Rule]", "Infinity"}]}], "]"}], 
        "\[IndentingNewLine]", 
        RowBox[{"FrobeniusSystem", "[", 
         RowBox[{
         "\[Kappa]_", ",", "c1_", ",", "c2_", ",", "\[Nu]N_", ",", 
          "\[Omega]N_", ",", 
          RowBox[{"parameters_", ":", "parameters"}]}], "]"}]}], ":=", 
       RowBox[{"Evaluate", "[", "\[IndentingNewLine]", 
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\[Chi]", "=", 
             RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}]}], ",", 
            RowBox[{"m", "=", 
             RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", " ", 
            RowBox[{"\[Mu]N", "=", 
             RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}]}], "}"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"fs", " ", "=", " ", 
              RowBox[{"FrobeniusSeries", "[", 
               RowBox[{"xN", ",", "\[Kappa]", ",", "c1", ",", "c2"}], "]"}]}],
              "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Block", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"expr", " ", "=", " ", 
                RowBox[{
                 SuperscriptBox["xN", 
                  RowBox[{
                   RowBox[{"I", "*", "\[Kappa]"}], "+", "2"}]], 
                 RowBox[{"DiffRadOpx", "@", "fs"}]}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Return", "@", 
               RowBox[{"LogicalExpand", "[", 
                RowBox[{
                 RowBox[{"Series", "[", 
                  RowBox[{"expr", ",", " ", 
                   RowBox[{"{", 
                    RowBox[{"xN", ",", "0", ",", "2"}], "}"}]}], "]"}], 
                 "\[Equal]", "0"}], "]"}]}]}], "]"}]}], "]"}]}], "]"}], 
        "]"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FrobeniusSystem", "[", 
     RowBox[{
     "\[Kappa]_", ",", "c1_", ",", "c2_", ",", "\[Nu]N_", ",", "\[Omega]N_", 
      ",", 
      RowBox[{"parameters_", ":", "parameters"}]}], "]"}], ":=", 
    RowBox[{"Evaluate", "[", "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Chi]", "=", 
          RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}]}], ",", 
         RowBox[{"m", "=", 
          RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", " ", 
         RowBox[{"\[Mu]N", "=", 
          RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}]}], "}"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Evaluate", "[", 
         RowBox[{"Import", "[", 
          RowBox[{
           RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
           "\"\<FrobeniusSystem.mx\>\""}], "]"}], "]"}], "[", 
        RowBox[{
        "\[Kappa]", ",", "c1", ",", "c2", ",", "\[Omega]N", ",", "\[Nu]N", 
         ",", 
         RowBox[{"parameters", "[", "\"\<m\>\"", "]"}], ",", " ", 
         RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}], ",", " ", 
         RowBox[{"parameters", "[", "\"\<\[Mu]N\>\"", "]"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"getRadialSolution", "[", 
     RowBox[{
      RowBox[{"w_", "?", "NumberQ"}], ",", " ", 
      RowBox[{"v_", "?", "NumberQ"}], ",", 
      RowBox[{"parameters_", ":", "parameters"}]}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Omega]vv", " ", "=", " ", "w"}], ",", " ", 
        RowBox[{"\[Nu]vv", "=", "v"}], ",", 
        RowBox[{"\[Chi]", "=", 
         RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}]}], ",", 
        RowBox[{"m", "=", 
         RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", 
        RowBox[{"\[Mu]N", "=", 
         RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"FrobeniusSolution", " ", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"NSolve", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"FrobeniusSystem", "[", 
                RowBox[{
                "\[Kappa]", ",", "c1", ",", "c2", ",", "\[Nu]vv", ",", 
                 "\[Omega]vv", ",", "parameters"}], "]"}], "//", 
               RowBox[{
                RowBox[{"Rationalize", "[", 
                 RowBox[{"#", ",", "0"}], "]"}], "&"}]}], ",", " ", 
              RowBox[{"{", 
               RowBox[{"\[Kappa]", ",", "c1", ",", "c2"}], "}"}], ",", " ", 
              RowBox[{"VerifySolutions", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"WorkingPrecision", "\[Rule]", "precision"}]}], "]"}], "//",
             "GetIngoingSolution"}], ")"}], "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "All"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"FrobR0", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Limit", "[", 
           RowBox[{
            RowBox[{"FrobeniusSeries", "[", 
             RowBox[{"x", ",", 
              RowBox[{"Sequence", "@@", "#"}]}], "]"}], ",", " ", 
            RowBox[{"x", "\[Rule]", "\[Epsilon]"}]}], "]"}], "&"}], "@", " ", 
         "FrobeniusSolution"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"FrobRPrime0", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Limit", "[", 
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{
              RowBox[{"FrobeniusSeries", "[", 
               RowBox[{"x", ",", 
                RowBox[{"Sequence", "@@", "#"}]}], "]"}], ",", "x"}], "]"}], 
            ",", " ", 
            RowBox[{"x", "\[Rule]", " ", "\[Epsilon]"}]}], "]"}], "&"}], "@", 
         "FrobeniusSolution"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"BC", " ", "=", " ", 
        RowBox[{
         RowBox[{"Thread", "@", 
          RowBox[{"{", 
           RowBox[{"FrobR0", ",", " ", "FrobRPrime0"}], "}"}]}], "//", 
         "ToPrecision"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"eq", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"DiffRadOpx", "@", 
                 RowBox[{"R", "[", "xN", "]"}]}], "//", "InsertValues"}], "//",
                "ToPrecision"}], ")"}], "/.", 
             RowBox[{"{", " ", 
              RowBox[{
               RowBox[{"\[Nu]N", "\[Rule]", "\[Nu]vv"}], ",", " ", 
               RowBox[{"\[Omega]N", "\[Rule]", "\[Omega]vv"}]}], "}"}]}], 
            ")"}], "\[Equal]", "0"}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"R", "[", "StartingX", "]"}], "\[Equal]", "FrobR0"}], "//",
            "ToPrecision"}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             SuperscriptBox["R", "\[Prime]"], "[", "StartingX", "]"}], 
            "\[Equal]", "FrobRPrime0"}], "//", "ToPrecision"}]}], "}"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"StartingRadius", " ", "=", "  ", "StartingX"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"EndingRadius", " ", "=", "  ", "EndingX"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"RadialSolutions", " ", "=", " ", 
        RowBox[{
         RowBox[{"NDSolve", "[", 
          RowBox[{
           RowBox[{"eq", "//", "ToPrecision"}], ",", "R", ",", " ", 
           RowBox[{"{", 
            RowBox[{
            "xN", ",", " ", "StartingRadius", ",", " ", "EndingRadius"}], 
            "}"}], ",", 
           RowBox[{"WorkingPrecision", "\[Rule]", "precision"}], ",", " ", 
           RowBox[{"MaxSteps", "\[Rule]", "maxstepintegrator"}]}], "]"}], "//",
          "First"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"R", "/.", "RadialSolutions"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"RoughMinimize", "[", 
     RowBox[{
      RowBox[{"\[Omega]guess_", "?", "NumberQ"}], ",", " ", 
      RowBox[{"\[Omega]res_", "?", "NumberQ"}], ",", 
      RowBox[{"\[Nu]input_", "?", "NumberQ"}], ",", " ", 
      RowBox[{"\[Omega]boundary_", "?", "ListQ"}], ",", " ", "MaxX_", ",", 
      " ", 
      RowBox[{"parameters_", ":", "parameters"}], ",", " ", 
      RowBox[{"Watcher_", "?", "BooleanQ"}]}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"SlopeTest", " ", "=", " ", 
        RowBox[{"-", "1"}]}], "}"}], ",", 
      RowBox[{"(*", 
       RowBox[{",", 
        RowBox[{"\[Chi]", "=", 
         RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}]}], ",", 
        RowBox[{"m", "=", 
         RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", " ", 
        RowBox[{"S", " ", "=", " ", 
         RowBox[{"parameters", "[", "\"\<s\>\"", "]"}]}], ",", 
        RowBox[{"\[Eta]", "=", 
         RowBox[{"parameters", "[", "\"\<\[Eta]\>\"", "]"}]}], ",", 
        RowBox[{"\[Mu]N", "=", 
         RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Omega]guessreal", " ", "=", " ", 
        RowBox[{"\[Omega]guess", "//", "Re"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Omega]guessim", " ", "=", " ", 
        RowBox[{"\[Omega]guess", "//", "Im"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Omega]boundaryceiling", " ", "=", " ", 
        RowBox[{
         RowBox[{"\[Omega]boundary", "//", "Last"}], "//", "Re"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Omega]boundaryfloor", " ", "=", " ", 
        RowBox[{
         RowBox[{"\[Omega]boundary", "//", "First"}], "//", "Re"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Delta]\[Omega]", " ", "=", " ", 
        RowBox[{
         FractionBox[
          RowBox[{
          "\[Omega]boundaryceiling", " ", "-", " ", "\[Omega]boundaryfloor"}],
           "\[Omega]res"], "//", "Re"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"DIRECTION", "=", 
        RowBox[{"-", "1"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Pick", " ", "random", " ", "direction", " ", "to", " ", "probe", " ",
          "the", " ", "sign", " ", "of", " ", "the", " ", "slope", " ", 
         RowBox[{"dR", "/", "d\[Omega]"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"CurrentRadialValue", " ", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"getRadialSolution", "[", 
            RowBox[{
            "\[Omega]guess", ",", " ", "\[Nu]input", ",", " ", "parameters"}],
             "]"}], "[", "MaxX", "]"}], "//", "Abs"}], "//", "Log10"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"TestValue", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"getRadialSolution", "[", 
            RowBox[{
             RowBox[{"\[Omega]guess", "+", 
              RowBox[{"DIRECTION", "*", "\[Delta]\[Omega]"}]}], ",", 
             "\[Nu]input", ",", "parameters"}], "]"}], "[", "MaxX", "]"}], "//",
           "Abs"}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "If", " ", "the", " ", "testvalue", " ", "is", " ", "larger", " ", 
          "than", " ", "the", " ", "currentvalue"}], ",", " ", 
         RowBox[{
         "then", " ", "we", " ", "picked", " ", "the", " ", "wrong", " ", 
          RowBox[{"direction", ".", " ", "Choose"}], " ", "the", " ", 
          "opposite", " ", "direction"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"TestValue", "-", "CurrentRadialValue"}], ">", "0"}], ",", 
         " ", 
         RowBox[{"DIRECTION", "=", 
          RowBox[{
           RowBox[{"-", "1"}], "*", "DIRECTION"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"counter", "=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ValueList", "[", "0", "]"}], "=", 
        RowBox[{"-", "1"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"Watcher", ",", 
         RowBox[{
          RowBox[{"counterString", "=", 
           RowBox[{"\"\<[RoughMinimization] Counter: \>\"", "<>", 
            RowBox[{"ToString", "[", "counter", "]"}]}]}], ";", 
          RowBox[{"Print", "@", 
           RowBox[{"Dynamic", "[", "counterString", "]"}]}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"SlopeTest", "<", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"NextFreqRealPart", " ", "=", " ", 
           RowBox[{"\[Omega]guessreal", " ", "+", " ", 
            RowBox[{
            "DIRECTION", "*", "counter", "*", "\[Delta]\[Omega]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"NextFreq", " ", "=", " ", 
           RowBox[{"NextFreqRealPart", " ", "+", " ", 
            RowBox[{"I", "*", "\[Omega]guessim"}]}]}], ";", " ", 
          RowBox[{"(*", 
           RowBox[{
           "Better", " ", "input", " ", "for", " ", "imaginary", " ", 
            RowBox[{"part", "?"}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"NextAngEigenValue", " ", "=", " ", 
           RowBox[{"getNuValue", "[", 
            RowBox[{"NextFreq", ",", " ", "parameters", ",", 
             RowBox[{"nuNNonRel", "[", 
              RowBox[{"NextFreq", ",", "parameters"}], "]"}]}], "]"}]}], ";", 
          " ", 
          RowBox[{"(*", 
           RowBox[{
           "Get", " ", "\[Nu]", " ", "value", " ", "from", " ", "solving", 
            " ", "angular", " ", "equation", " ", "determinant"}], "*)"}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"NextValue", "  ", "=", " ", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"getRadialSolution", "[", 
               RowBox[{
               "NextFreq", ",", " ", "NextAngEigenValue", ",", "parameters"}],
                "]"}], "[", "MaxX", "]"}], "//", "Abs"}], "//", "Log10"}]}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ValueList", "[", "counter", "]"}], "=", "NextValue"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\[Omega]List", "[", "counter", "]"}], "=", "NextFreq"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\[Nu]List", "[", "counter", "]"}], "=", 
           "NextAngEigenValue"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"counter", "\[LessEqual]", "2"}], ",", 
            RowBox[{"-", "1"}], ",", " ", 
            RowBox[{
             RowBox[{"SlopeTest", " ", "=", 
              RowBox[{
               RowBox[{"ValueList", "[", "counter", "]"}], "-", " ", 
               RowBox[{"ValueList", "[", 
                RowBox[{"counter", "-", "1"}], "]"}]}]}], ";"}]}], "]"}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Prevent", " ", "Infinite", " ", "loop"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"counter", ">", "500"}], ",", " ", 
            RowBox[{
             RowBox[{
             "Print", "[", 
              "\"\<RoughMinimization step surpassed 500 iterations! \
Breaking...\>\"", "]"}], ";", 
             RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"counter", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"Watcher", ",", 
            RowBox[{"counterString", "=", 
             RowBox[{"\"\<[RoughMinimization] Counter: \>\"", "<>", 
              RowBox[{"ToString", "[", "counter", "]"}], "<>", 
              "\"\< \\n Slope Test: \>\"", "<>", 
              RowBox[{"ToString", "[", 
               RowBox[{"SlopeTest", ",", " ", "InputForm"}], "]"}]}]}]}], 
           "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"RoughMinimizationResults", " ", "=", " ", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<\[Omega]\>\"", "\[Rule]", " ", 
           RowBox[{"\[Omega]List", "[", 
            RowBox[{"counter", "-", "1"}], "]"}]}], ",", " ", 
          RowBox[{"\"\<\[Nu]\>\"", "\[Rule]", " ", 
           RowBox[{"\[Nu]List", "[", 
            RowBox[{"counter", "-", "1"}], "]"}]}]}], "|>"}]}], " ", ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"RoughMinimizationResults", ",", " ", "Module"}], "]"}], 
       ";"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"NelderMead2D", "::", "usage"}], "=", 
     "\"\<\nNelderMead2D[objFunc, initialSimplex, Precisiongoal, \
Accuracygoal, Watcher]\n\nobjFunc is the HEAD of the function to be minimized \
and whose argument structure is such that it can be evaluated on a 2D set.\
\[IndentingNewLine]initialSimplex is the initial simplex on which to begin \
the algorithm. Must contain 3 points.\[IndentingNewLine]Precision goal sets \
absolute difference in values of objective function evaluated on nodes of \
simplex. This is one of the Termination \
constraints.\[IndentingNewLine]Accuracy goal sets absolute size of simplex. \
This is the other termination constraints.\[IndentingNewLine]BOTH termination \
constraints must be satisfied for algorithm to \[IndentingNewLine]terminate. \
Note: This unusual requirement stems from requirements of the code this \
algorithm is being embedded in.\nWatcher is a boolean that switches wether an \
iteration counter should be printed during evaluation. DEFAULT: False.\n\
\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NelderMead2D", "[", 
     RowBox[{
     "objFunc_", ",", "initialSimplex_", ",", "Precisiongoal_", ",", " ", 
      "Accuracygoal_", ",", " ", 
      RowBox[{"Watcher_", ":", "False"}]}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Alpha]", "=", "1"}], ",", 
        RowBox[{"\[Beta]", "=", "2"}], ",", 
        RowBox[{"\[Rho]", "=", 
         FractionBox["1", "2"]}], ",", " ", 
        RowBox[{"\[Sigma]", "=", 
         FractionBox["1", "2"]}]}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Evaluate", " ", "objective", " ", "function", " ", "on", " ", 
        "initial", " ", "simplex"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"currentFuncValues", " ", "=", " ", 
        RowBox[{"objFunc", "/@", "initialSimplex"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"currentSimplex", " ", "=", " ", "initialSimplex"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"NMCounter", " ", "=", " ", "1"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"NMSnooper", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"If", "[", 
        RowBox[{"Watcher", ",", " ", 
         RowBox[{"Print", "@", 
          RowBox[{"Dynamic", "[", 
           RowBox[{"\"\<[FineMinimization] Iteration number: \>\"", "<>", 
            RowBox[{"ToString", "[", "NMCounter", "]"}], "<>", 
            "\"\<\\nCurrent Best Value: \>\"", "<>", 
            RowBox[{"ToString", "[", "NMSnooper", "]"}]}], "]"}]}]}], "]"}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"While", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Max", "[", "currentFuncValues", "]"}], "-", 
              RowBox[{"Min", "[", "currentFuncValues", "]"}]}], ")"}], ">", 
            "Precisiongoal"}], ")"}], " ", "&&", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Max", "[", "currentSimplex", "]"}], "-", 
              RowBox[{"Min", "[", "currentSimplex", "]"}]}], ")"}], " ", ">", 
            "Accuracygoal"}], ")"}]}], ",", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Order", " ", "objective", " ", "function", " ", "on", " ", 
           "simplex"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"orderingIndicies", " ", "=", " ", 
           RowBox[{"Ordering", "[", "currentFuncValues", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"orderedcurrentFuncValues", " ", "=", " ", 
           RowBox[{"currentFuncValues", "[", 
            RowBox[{"[", "orderingIndicies", "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"orderedcurrentSimplex", " ", "=", " ", 
           RowBox[{"currentSimplex", "[", 
            RowBox[{"[", "orderingIndicies", "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"BestPoint", " ", "=", " ", 
           RowBox[{"orderedcurrentSimplex", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"WorstPoint", " ", "=", " ", 
           RowBox[{"orderedcurrentSimplex", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"MiddlePoint", " ", "=", " ", 
           RowBox[{"orderedcurrentSimplex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"BestValue", " ", "=", " ", 
           RowBox[{"orderedcurrentFuncValues", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"MiddleValue", " ", "=", " ", 
           RowBox[{"orderedcurrentFuncValues", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"WorstValue", " ", "=", " ", 
           RowBox[{"orderedcurrentFuncValues", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"currentCentroid", " ", "=", " ", 
           RowBox[{
            FractionBox["1", "2"], "*", 
            RowBox[{"(", 
             RowBox[{"BestPoint", " ", "+", " ", "MiddlePoint"}], ")"}]}]}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"currentTrialPoint", " ", "=", " ", 
           RowBox[{"currentCentroid", " ", "+", 
            RowBox[{"\[Alpha]", "*", 
             RowBox[{"(", 
              RowBox[{"currentCentroid", " ", "-", " ", "WorstPoint"}], 
              ")"}]}]}]}], ";", " ", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Reflection", " ", "of", " ", "worst", " ", "point", " ", "across",
             " ", "centroid"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"currentTrialValue", " ", "=", " ", 
           RowBox[{"objFunc", "@", "currentTrialPoint"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", "Reflection", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "If", " ", "new", " ", "funcvalue", " ", "is", " ", "not", " ", 
             "the", " ", "worst", " ", "or", " ", "the", " ", "best"}], ",", 
            " ", 
            RowBox[{
            "replace", " ", "current", " ", "worst", " ", "by", " ", "trial", 
             " ", "point"}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
            "BestValue", "\[LessEqual]", "currentTrialValue", "<", 
             "MiddleValue"}], ",", "\[IndentingNewLine]", "\t", 
            RowBox[{
             RowBox[{"NewSimplex", " ", "=", " ", 
              RowBox[{"ReplacePart", "[", 
               RowBox[{"orderedcurrentSimplex", ",", 
                RowBox[{"3", "\[Rule]", " ", "currentTrialPoint"}]}], "]"}]}],
              ";", "\[IndentingNewLine]", "\t", 
             RowBox[{"Goto", "[", "LoopEnd", "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", "Expansion", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "if", " ", "new", " ", "funcvalue", " ", "is", " ", "the", " ", 
             "best", " ", "so", " ", "far"}], ",", " ", 
            RowBox[{"perform", " ", "expansion"}]}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"currentTrialValue", "<", 
             RowBox[{"orderedcurrentFuncValues", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"expansionPoint", " ", "=", " ", 
              RowBox[{"currentCentroid", " ", "+", " ", 
               RowBox[{"\[Beta]", "*", 
                RowBox[{"(", 
                 RowBox[{
                 "currentTrialPoint", " ", "-", " ", "currentCentroid"}], 
                 ")"}]}]}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
               "if", " ", "expansion", " ", "point", " ", "is", " ", 
                "successful"}], ",", " ", 
               RowBox[{
               "replace", " ", "current", " ", "worst", " ", "by", " ", 
                "expanded", " ", "point"}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"objFunc", "@", "expansionPoint"}], "<", 
                "currentTrialValue"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"NewSimplex", " ", "=", " ", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"orderedcurrentSimplex", ",", " ", 
                   RowBox[{"3", "\[Rule]", " ", "expansionPoint"}]}], "]"}]}],
                 ";", "\[IndentingNewLine]", 
                RowBox[{"Goto", "[", "LoopEnd", "]"}], ";"}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"if", " ", "expansion", " ", "fails"}], ",", " ", 
               RowBox[{
               "then", " ", "just", " ", "replace", " ", "the", " ", 
                "current", " ", "worst", " ", "by", " ", "the", " ", "trial", 
                " ", "point"}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"NewSimplex", "=", 
              RowBox[{"ReplacePart", "[", 
               RowBox[{"orderedcurrentSimplex", ",", " ", 
                RowBox[{"3", "\[Rule]", " ", "currentTrialPoint"}]}], "]"}]}],
              ";", "\[IndentingNewLine]", 
             RowBox[{"Goto", "[", "LoopEnd", "]"}], ";"}]}], "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", "Contraction", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "If", " ", "new", " ", "funcvalue", " ", "is", " ", "worst", " ", 
             "than", " ", "current", " ", "second", " ", "worst"}], ",", " ", 
            
            RowBox[{"perform", " ", "contraction"}]}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"currentTrialValue", "\[GreaterEqual]", "MiddleValue"}], 
            ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
              "If", " ", "new", " ", "funcvalue", " ", "is", " ", "better", 
               " ", "than", " ", "the", " ", "worst"}], ",", " ", 
              RowBox[{"contract", " ", "on", " ", "outside"}]}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"currentTrialValue", "<", "WorstValue"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"currentContractedOutsidePoint", "=", 
                 RowBox[{"currentCentroid", "+", 
                  RowBox[{"\[Rho]", "*", 
                   RowBox[{"(", 
                    RowBox[{"currentTrialPoint", "-", "currentCentroid"}], 
                    ")"}]}]}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{
                  "If", " ", "new", " ", "contracted", " ", "value", " ", 
                   "is", " ", "better", " ", "than", " ", "trial"}], ",", " ", 
                  RowBox[{
                  "replace", " ", "worse", " ", "point", " ", "with", " ", 
                   "contracted", " ", "point"}]}], "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"objFunc", "@", "currentContractedOutsidePoint"}], 
                   "<", "currentTrialValue"}], ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"NewSimplex", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"orderedcurrentSimplex", ",", " ", 
                    RowBox[{
                    "3", "\[Rule]", "currentContractedOutsidePoint"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"Goto", "[", "LoopEnd", "]"}], ";"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"if", " ", "not"}], ",", " ", 
                    RowBox[{"go", " ", "to", " ", "shrink", " ", "step"}]}], 
                   "*)"}], "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"Goto", "[", "ShrinkStep", "]"}], ";"}]}], "]"}], 
                ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
               "if", " ", "new", " ", "funcvalue", " ", "is", " ", "the", " ",
                 "worse", " ", "so", " ", "far"}], ",", " ", 
               RowBox[{"contract", " ", "on", " ", "inside"}]}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"currentTrialValue", "\[GreaterEqual]", "WorstValue"}],
                ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"currentContractedInsidePoint", "=", 
                 RowBox[{"currentCentroid", " ", "+", " ", 
                  RowBox[{"\[Rho]", "*", 
                   RowBox[{"(", 
                    RowBox[{"WorstPoint", "-", "currentCentroid"}], 
                    ")"}]}]}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"objFunc", "@", "currentContractedInsidePoint"}], 
                   "<", "WorstValue"}], ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"NewSimplex", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"orderedcurrentSimplex", ",", 
                    RowBox[{
                    "3", "\[Rule]", "currentContractedInsidePoint"}]}], 
                    "]"}]}], ";", 
                   RowBox[{"Goto", "[", "LoopEnd", "]"}], ";"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"Goto", "[", "ShrinkStep", "]"}], ";"}]}], 
                 "]"}]}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Shrink", " ", "all", " ", "values"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"Label", "[", "ShrinkStep", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"NewSimplex", " ", "=", " ", 
           RowBox[{"ReplacePart", "[", 
            RowBox[{"orderedcurrentSimplex", ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"2", "\[Rule]", " ", 
                RowBox[{"BestPoint", "+", 
                 RowBox[{"\[Sigma]", "*", 
                  RowBox[{"(", 
                   RowBox[{"MiddlePoint", "-", "BestPoint"}], ")"}]}]}]}], 
               ",", " ", 
               RowBox[{"3", "\[Rule]", " ", 
                RowBox[{"BestPoint", "+", 
                 RowBox[{"\[Sigma]", "*", 
                  RowBox[{"(", 
                   RowBox[{"WorstPoint", "-", "BestPoint"}], ")"}]}]}]}]}], 
              "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"repeat", " ", "loop"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Label", "[", "LoopEnd", "]"}], ";", "\[IndentingNewLine]", 
          
          RowBox[{"currentSimplex", " ", "=", " ", "NewSimplex"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"currentFuncValues", " ", "=", " ", 
           RowBox[{"objFunc", "/@", "NewSimplex"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"NMCounter", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{"NMSnooper", "=", 
           RowBox[{"Min", "[", "currentFuncValues", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"PrecisionTermination", " ", "=", " ", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Max", "[", "currentFuncValues", "]"}], "-", 
                RowBox[{"Min", "[", "currentFuncValues", "]"}]}], ")"}], ">", 
              "Precisiongoal"}], ")"}], " ", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AccuracyTermination", " ", "=", " ", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Max", "[", "currentSimplex", "]"}], "-", 
                RowBox[{"Min", "[", "currentSimplex", "]"}]}], ")"}], " ", 
              ">", "Accuracygoal"}], ")"}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"PrecisionTermination", ",", " ", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<Termination due to precision goal! Value: \>\"", ",", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Max", "[", "currentFuncValues", "]"}], "-", 
             RowBox[{"Min", "[", "currentFuncValues", "]"}]}], ")"}]}], 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"AccuracyTermination", ",", " ", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<Termination due to accuracy goal! Value: \>\"", ",", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Max", "[", "currentSimplex", "]"}], "-", 
             RowBox[{"Min", "[", "currentSimplex", "]"}]}], ")"}]}], "]"}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"orderingIndicies", " ", "=", " ", 
        RowBox[{"Ordering", "[", "currentFuncValues", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"currentFuncValues", "[", 
            RowBox[{"[", "orderingIndicies", "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"currentSimplex", "[", 
            RowBox[{"[", "orderingIndicies", "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FineMinimize", "[", 
      RowBox[{"RoughMinimizationResults_", ",", " ", "OmegaBoundary_", ",", 
       RowBox[{"parameters_", ":", "parameters"}], ",", " ", 
       RowBox[{"Watcher_", ":", "False"}]}], "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Block", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[Chi]", "=", 
          RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}]}], ",", " ", 
         RowBox[{"\[Eta]", "=", 
          RowBox[{"parameters", "[", "\"\<\[Eta]\>\"", "]"}]}], ",", " ", 
         RowBox[{"m", "=", 
          RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", 
         RowBox[{"s", "=", 
          RowBox[{"parameters", "[", "\"\<s\>\"", "]"}]}], ",", " ", 
         RowBox[{"\[Mu]N", "=", 
          RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}]}], "}"}], ",",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"functomin", "[", 
          RowBox[{"\[Omega]realimaglist_", "?", "ListQ"}], "]"}], ":=", 
         "\[IndentingNewLine]", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[Omega]value", "=", 
             RowBox[{
              RowBox[{"\[Omega]realimaglist", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", 
              RowBox[{"I", "*", 
               RowBox[{"\[Omega]realimaglist", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"nuroot", " ", "=", " ", 
               RowBox[{"Evaluate", "@", 
                RowBox[{"getNuValue", "[", 
                 RowBox[{"\[Omega]value", ",", " ", "parameters", ",", 
                  RowBox[{"ToPrecision", "@", 
                   RowBox[{"nuNNonRel", "[", "parameters", "]"}]}]}], 
                 "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"retval", " ", "=", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"getRadialSolution", "[", 
                   RowBox[{
                   "\[Omega]value", ",", "nuroot", ",", "parameters"}], "]"}],
                   "[", "EndingX", "]"}], "//", "Abs"}], "//", "Log10"}]}], 
              ";", "\[IndentingNewLine]", "retval"}]}], "\[IndentingNewLine]",
             "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"guess", "=", 
         RowBox[{"RoughMinimizationResults", "[", "\"\<\[Omega]\>\"", "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"SimplexBase", " ", "=", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"guess", "//", "Re"}], ",", " ", 
            RowBox[{"guess", "//", "Im"}]}], "}"}], "//", "ToPrecision"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"SimplexNodeOne", " ", "=", " ", 
         RowBox[{"SimplexBase", "-", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             FractionBox[
              RowBox[{
               RowBox[{"OmegaBoundary", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "-", "guess"}], "omegaRes"], "//",
              "Re"}], ",", "0"}], "}"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"SimplexNodeTwo", " ", "=", " ", 
         RowBox[{"SimplexBase", " ", "-", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", " ", 
            SuperscriptBox["10", 
             RowBox[{
              RowBox[{"Log10", "[", 
               RowBox[{"Abs", "@", 
                RowBox[{"Im", "[", "guess", "]"}]}], "]"}], "-", "1"}]]}], 
           "}"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"InitialSimplex", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{
          "SimplexBase", ",", " ", "SimplexNodeOne", ",", " ", 
           "SimplexNodeTwo"}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Minimizer", " ", "=", " ", 
         RowBox[{"NelderMead2D", "[", 
          RowBox[{"functomin", ",", " ", "InitialSimplex", ",", 
           SuperscriptBox["10", 
            RowBox[{"-", "OptimizationPrecision"}]], ",", 
           SuperscriptBox["10", 
            RowBox[{"-", "OptimizationAccuracy"}]], ",", " ", "Watcher"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"omegaval", "=", 
         RowBox[{
          RowBox[{"Minimizer", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "//", "R2toC"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"nuval", " ", "=", " ", 
         RowBox[{"getNuValue", "[", 
          RowBox[{"omegaval", ",", " ", "parameters", ",", 
           RowBox[{"nuNNonRel", "[", 
            RowBox[{"omegaval", ",", "parameters"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"FineMinimizationResults", " ", "=", " ", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<\[Omega]\>\"", "\[Rule]", " ", "omegaval"}], ",", " ", 
           RowBox[{"\"\<\[Nu]\>\"", "\[Rule]", "nuval"}]}], " ", "|>"}]}]}]}],
       "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FKKSProca", "[", "U", "]"}], "[", 
     RowBox[{"solution_", ",", " ", 
      RowBox[{"OutputForm", ":", 
       RowBox[{"(", 
        RowBox[{"_", "?", "AssociationQ"}], ")"}], ":", 
       RowBox[{"<|", 
        RowBox[{
         RowBox[{"\"\<AsInterp\>\"", "->", "True"}], ",", " ", 
         RowBox[{"\"\<AsCompiled\>\"", "->", "False"}], ",", 
         RowBox[{"\"\<AsAnonymous\>\"", "->", "False"}]}], "|>"}]}]}], "]"}], 
    ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Not]", 
           RowBox[{"OutputForm", "[", "\"\<AsInterp\>\"", "]"}]}], " ", "||", 
          
          RowBox[{"OutputForm", "[", "\"\<AsCompiled\>\"", "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"res", " ", "=", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"PolarizationComponents", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "*", 
                  RowBox[{"D", "[", 
                   RowBox[{
                    RowBox[{"FKKSZ", "[", 
                    RowBox[{"solution", ",", " ", 
                    RowBox[{"<|", 
                    RowBox[{"\"\<AsInterp\>\"", "->", "False"}], "|>"}]}], 
                    "]"}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                    "}"}], "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ",", " ", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", "1", ",", "4"}], "}"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}], "//", 
             "FromXACTSymbol"}], "//", 
            RowBox[{"ApplyParameters", "[", "solution", "]"}]}]}], ";"}], ",",
          "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"res", " ", "=", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"PolarizationComponents", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "*", 
                  RowBox[{"D", "[", 
                   RowBox[{
                    RowBox[{"FKKSZ", "[", "solution", "]"}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                    "}"}], "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ",", " ", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", "1", ",", "4"}], "}"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}], "//", 
             "FromXACTSymbol"}], "//", 
            RowBox[{"ApplyParameters", "[", "solution", "]"}]}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"KeyExistsQ", "[", 
           RowBox[{"OutputForm", ",", "\"\<AsAnonymous\>\""}], "]"}], "&&", 
          RowBox[{"OutputForm", "[", "\"\<AsAnonymous\>\"", "]"}]}], ",", 
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], 
           ",", 
           RowBox[{"Evaluate", "@", "res"}]}], "]"}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"KeyExistsQ", "[", 
             RowBox[{"OutputForm", ",", "\"\<AsCompiled\>\""}], "]"}], "&&", 
            RowBox[{"OutputForm", "[", "\"\<AsCompiled\>\"", "]"}]}], ",", 
           RowBox[{"Compile", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], 
             ",", 
             RowBox[{"Evaluate", "@", "res"}], ",", " ", 
             RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}]}], "]"}], 
           ",", "\[IndentingNewLine]", "res"}], "\[IndentingNewLine]", 
          "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FKKSProca", "[", "L", "]"}], "[", 
     RowBox[{"solution_", ",", " ", 
      RowBox[{"OutputForm", ":", 
       RowBox[{"(", 
        RowBox[{"_", "?", "AssociationQ"}], ")"}], ":", 
       RowBox[{"<|", 
        RowBox[{
         RowBox[{"\"\<AsInterp\>\"", "->", "True"}], ",", " ", 
         RowBox[{"\"\<AsCompiled\>\"", "->", "False"}], ",", 
         RowBox[{"\"\<AsAnonymous\>\"", "->", "False"}]}], "|>"}]}]}], "]"}], 
    ":=", "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmp", " ", "=", " ", 
        RowBox[{
         RowBox[{"FKKSProca", "[", "U", "]"}], "[", 
         RowBox[{"solution", ",", " ", "OutputForm"}], "]"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         UnderoverscriptBox["\[Sum]", 
          RowBox[{"\[Sigma]", "=", "1"}], "4"], 
         RowBox[{
          RowBox[{"KerrComponents", "[", 
           RowBox[{"[", 
            RowBox[{"\[Mu]", ",", "\[Sigma]"}], "]"}], "]"}], 
          RowBox[{"tmp", "[", 
           RowBox[{"[", "\[Sigma]", "]"}], "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"\[Mu]", ",", "1", ",", "4"}], "}"}]}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FKKSFieldStrength", "::", "usage"}], "=", 
     "\"\<Computes field strength tensor of proca field for various index \
structures\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FKKSFieldStrength", "[", "UU", "]"}], "[", "solution_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"dP", "=", " ", 
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"FKKSProca", "[", "U", "]"}], "[", "solution", "]"}], ",", 
          " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], 
            ",", "1"}], "}"}]}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          UnderoverscriptBox["\[Sum]", 
           RowBox[{"\[Sigma]", "=", "1"}], "4"], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"IKerrComponents", "[", 
              RowBox[{"[", 
               RowBox[{"\[Mu]", ",", "\[Sigma]"}], "]"}], "]"}], 
             RowBox[{"dP", "[", 
              RowBox[{"[", 
               RowBox[{"\[Nu]", ",", "\[Sigma]"}], "]"}], "]"}]}], "-", " ", 
            RowBox[{
             RowBox[{"IKerrComponents", "[", 
              RowBox[{"[", 
               RowBox[{"\[Nu]", ",", "\[Sigma]"}], "]"}], "]"}], 
             RowBox[{"dP", "[", 
              RowBox[{"[", 
               RowBox[{"\[Mu]", ",", "\[Sigma]"}], "]"}], "]"}]}]}], ")"}]}], 
         "\[IndentingNewLine]", ",", " ", 
         RowBox[{"{", 
          RowBox[{"\[Mu]", ",", "1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Nu]", ",", "1", ",", "4"}], "}"}]}], "]"}], "//", 
       RowBox[{"ApplyParameters", "[", "solution", "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FKKSFieldStrength", "[", "LL", "]"}], "[", "solution_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmp", " ", "=", " ", 
        RowBox[{
         RowBox[{"FKKSFieldStrength", "[", "UU", "]"}], "[", "solution", 
         "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          UnderoverscriptBox["\[Sum]", 
           RowBox[{"\[Sigma]", "=", "1"}], "4"], 
          RowBox[{
           UnderoverscriptBox["\[Sum]", 
            RowBox[{"\[Rho]", "=", "1"}], "4"], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"KerrComponents", "[", 
              RowBox[{"[", 
               RowBox[{"\[Mu]", ",", "\[Rho]"}], "]"}], "]"}], "*", 
             RowBox[{"KerrComponents", "[", 
              RowBox[{"[", 
               RowBox[{"\[Nu]", ",", "\[Sigma]"}], "]"}], "]"}], "*", 
             RowBox[{"tmp", "[", 
              RowBox[{"[", 
               RowBox[{"\[Rho]", ",", "\[Sigma]"}], "]"}], "]"}]}], ")"}]}]}],
          "\[IndentingNewLine]", ",", " ", 
         RowBox[{"{", 
          RowBox[{"\[Mu]", ",", "1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Nu]", ",", "1", ",", "4"}], "}"}]}], "]"}], "//", 
       RowBox[{"ApplyParameters", "[", "solution", "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FKKSFieldStrength", "[", "UL", "]"}], "[", "solution_", "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmp", " ", "=", " ", 
        RowBox[{
         RowBox[{"FKKSFieldStrength", "[", "UU", "]"}], "[", "solution", 
         "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          UnderoverscriptBox["\[Sum]", 
           RowBox[{"\[Sigma]", "=", "1"}], "4"], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"KerrComponents", "[", 
             RowBox[{"[", 
              RowBox[{"\[Nu]", ",", "\[Sigma]"}], "]"}], "]"}], "*", 
            RowBox[{"tmp", "[", 
             RowBox[{"[", 
              RowBox[{"\[Mu]", ",", "\[Sigma]"}], "]"}], "]"}]}], ")"}]}], 
         "\[IndentingNewLine]", ",", " ", 
         RowBox[{"{", 
          RowBox[{"\[Mu]", ",", "1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\[Nu]", ",", "1", ",", "4"}], "}"}]}], "]"}], "//", 
       RowBox[{"ApplyParameters", "[", "solution", "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FKKSEnergyMomentum", "[", "UU", "]"}], "[", 
     RowBox[{"solution_", ",", " ", 
      RowBox[{"OutputForm", ":", 
       RowBox[{"(", 
        RowBox[{"_", "?", "AssociationQ"}], ")"}], ":", 
       RowBox[{"<|", 
        RowBox[{"\"\<AsAnonymous\>\"", "\[Rule]", "False"}], "|>"}]}]}], 
     "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Fll", "=", 
         RowBox[{
          RowBox[{"FKKSFieldStrength", "[", "LL", "]"}], "[", "solution", 
          "]"}]}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{"Fuu", " ", "=", " ", 
         RowBox[{
          RowBox[{"FKKSFieldStrength", "[", "UU", "]"}], "[", "solution", 
          "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Ful", " ", "=", " ", 
         RowBox[{
          RowBox[{"FKKSFieldStrength", "[", "UL", "]"}], "[", "solution", 
          "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Al", " ", "=", " ", 
         RowBox[{
          RowBox[{"FKKSProca", "[", "L", "]"}], "[", "solution", "]"}]}], ",",
         " ", "\[IndentingNewLine]", 
        RowBox[{"Au", " ", "=", " ", 
         RowBox[{
          RowBox[{"FKKSProca", "[", "U", "]"}], "[", "solution", "]"}]}]}], 
       "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"res", " ", "=", " ", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              UnderoverscriptBox["\[Sum]", 
               RowBox[{"\[Mu]", "=", "1"}], "4"], 
              RowBox[{
               UnderoverscriptBox["\[Sum]", 
                RowBox[{"\[Nu]", "=", "1"}], "4"], 
               RowBox[{"(", 
                RowBox[{
                 FractionBox[
                  RowBox[{"-", "1"}], "8"], 
                 RowBox[{"Fll", "[", 
                  RowBox[{"[", 
                   RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}], "]"}], 
                 RowBox[{"Fuu", "[", 
                  RowBox[{"[", 
                   RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}], "]"}], "*", 
                 RowBox[{"KerrComponents", "[", 
                  RowBox[{"[", 
                   RowBox[{"\[Rho]", ",", "\[Sigma]"}], "]"}], "]"}]}], 
                ")"}]}]}], " ", "+", " ", "\[IndentingNewLine]", 
             RowBox[{
              UnderoverscriptBox["\[Sum]", 
               RowBox[{"\[Nu]", "=", "1"}], "4"], 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 FractionBox["1", "2"], 
                 RowBox[{"Fuu", "[", 
                  RowBox[{"[", 
                   RowBox[{"\[Rho]", ",", "\[Nu]"}], "]"}], "]"}], 
                 RowBox[{"Ful", "[", 
                  RowBox[{"[", 
                   RowBox[{"\[Sigma]", ",", "\[Nu]"}], "]"}], "]"}]}], " ", 
                "+", " ", 
                RowBox[{
                 FractionBox["1", "4"], 
                 RowBox[{"KerrComponents", "[", 
                  RowBox[{"[", 
                   RowBox[{"\[Rho]", ",", "\[Sigma]"}], "]"}], "]"}], 
                 RowBox[{"Al", "[", 
                  RowBox[{"[", "\[Nu]", "]"}], "]"}], "*", 
                 RowBox[{"Au", "[", 
                  RowBox[{"[", "\[Nu]", "]"}], "]"}]}]}], ")"}]}], " ", "-", 
             " ", "\[IndentingNewLine]", 
             RowBox[{
              FractionBox["1", "2"], 
              RowBox[{"Au", "[", 
               RowBox[{"[", "\[Rho]", "]"}], "]"}], 
              RowBox[{"Au", "[", 
               RowBox[{"[", "\[Sigma]", "]"}], "]"}]}]}], ")"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"\[Rho]", ",", "1", ",", "4"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Sigma]", ",", "1", ",", "4"}], "}"}]}], 
          "\[IndentingNewLine]", "]"}], "//", 
         RowBox[{"ApplyParameters", "[", "solution", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"KeyExistsQ", "[", 
           RowBox[{"OutputForm", ",", " ", "\"\<AsAnonymous\>\""}], "]"}], "&&", 
          RowBox[{"OutputForm", "[", "\"\<AsAnonymous\>\"", "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], 
           ",", " ", 
           RowBox[{"Evaluate", "[", "res", "]"}]}], "]"}], ",", 
         "\[IndentingNewLine]", "res"}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FKKSEnergyMomentum", "[", "UL", "]"}], "[", 
     RowBox[{"solution_", ",", "  ", 
      RowBox[{"OutputForm", ":", 
       RowBox[{"(", 
        RowBox[{"_", "?", "AssociationQ"}], ")"}], ":", 
       RowBox[{"<|", 
        RowBox[{"\"\<AsAnonymous\>\"", "\[Rule]", "False"}], "|>"}]}]}], 
     "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tmp", " ", "=", " ", 
        RowBox[{
         RowBox[{"FKKSEnergyMomentum", "[", "UU", "]"}], "[", 
         RowBox[{"solution", ",", " ", "OutputForm"}], "]"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"res", " ", "=", " ", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"OutputForm", "[", "\"\<AsAnonymous\>\"", "]"}], ",", 
             RowBox[{
              UnderoverscriptBox["\[Sum]", 
               RowBox[{"\[Sigma]", "=", "1"}], "4"], 
              RowBox[{
               RowBox[{"KerrComponents", "[", 
                RowBox[{"[", 
                 RowBox[{"\[Nu]", ",", "\[Sigma]"}], "]"}], "]"}], 
               RowBox[{
                RowBox[{"tmp", "[", 
                 RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                 "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"\[Mu]", ",", "\[Sigma]"}], "]"}], "]"}]}]}], ",", 
             RowBox[{
              UnderoverscriptBox["\[Sum]", 
               RowBox[{"\[Sigma]", "=", "1"}], "4"], 
              RowBox[{
               RowBox[{"KerrComponents", "[", 
                RowBox[{"[", 
                 RowBox[{"\[Nu]", ",", "\[Sigma]"}], "]"}], "]"}], 
               RowBox[{"tmp", "[", 
                RowBox[{"[", 
                 RowBox[{"\[Mu]", ",", "\[Sigma]"}], "]"}], "]"}]}]}]}], 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "1", ",", "4"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\[Nu]", ",", "1", ",", "4"}], "}"}]}], 
          "\[IndentingNewLine]", "]"}], "//", 
         RowBox[{"ApplyParameters", "[", "solution", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OutputForm", "[", "\"\<AsAnonymous\>\"", "]"}], ",", " ", 
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], 
           ",", " ", 
           RowBox[{"Evaluate", "[", "res", "]"}]}], "]"}], ",", " ", "res"}], 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.860195026264374*^9, 3.8601954110276403`*^9}, {
   3.860195520768551*^9, 3.8601956277476673`*^9}, {3.8601956965872*^9, 
   3.860195749094225*^9}, {3.860195780461906*^9, 3.860195939643471*^9}, {
   3.8601959855810823`*^9, 3.860195988420764*^9}, {3.860196022778737*^9, 
   3.860196159078434*^9}, {3.860196458671356*^9, 3.860196472962386*^9}, {
   3.860196547110025*^9, 3.860196552369164*^9}, {3.860196593105276*^9, 
   3.860196606984202*^9}, {3.860196637140533*^9, 3.860196655257491*^9}, {
   3.860196688989292*^9, 3.8601967757954073`*^9}, {3.860196918720995*^9, 
   3.8601972579466133`*^9}, 3.860197330528729*^9, {3.860197440664208*^9, 
   3.86019745760032*^9}, {3.860197517042741*^9, 3.860197519465693*^9}, {
   3.860197741171629*^9, 3.8601977419338837`*^9}, {3.860197798218494*^9, 
   3.860197944424251*^9}, 3.860198024299459*^9, {3.860198124416781*^9, 
   3.8601982188970947`*^9}, {3.8601984452232847`*^9, 
   3.8601984745043793`*^9}, {3.8601985254935007`*^9, 
   3.8601985444096317`*^9}, {3.86019861949902*^9, 3.860198634997046*^9}, {
   3.860199329750845*^9, 3.860199339171918*^9}, {3.860200300471298*^9, 
   3.8602003046073723`*^9}, {3.860200391384025*^9, 3.860200396220829*^9}, {
   3.860200431633539*^9, 3.860200639108425*^9}, {3.8602006696579523`*^9, 
   3.8602006703146687`*^9}, {3.860200712307294*^9, 3.860200729984077*^9}, {
   3.8602013521838427`*^9, 3.860201355716717*^9}, {3.86020141446574*^9, 
   3.860201417211163*^9}, {3.860201666885096*^9, 3.860201667671651*^9}, {
   3.86020282654906*^9, 3.860202826987506*^9}, {3.860203085863274*^9, 
   3.860203178342909*^9}, {3.860203241400153*^9, 3.860203360661707*^9}, {
   3.8602034115073957`*^9, 3.8602035134026318`*^9}, {3.860203860385521*^9, 
   3.860203916173399*^9}, {3.860203946715994*^9, 3.860203977681773*^9}, {
   3.860204012667458*^9, 3.860204028861135*^9}, {3.860204513077075*^9, 
   3.860204566219528*^9}, {3.860204874018042*^9, 3.860204898302724*^9}, {
   3.860204939889344*^9, 3.860204963152114*^9}, {3.8602051189272137`*^9, 
   3.86020512195724*^9}, {3.860205899769002*^9, 3.8602059080196323`*^9}, {
   3.860205940767767*^9, 3.860205941917527*^9}, {3.86020602332094*^9, 
   3.8602060596672564`*^9}, 3.8602062828219833`*^9, 3.860206938265411*^9, {
   3.860207102773418*^9, 3.8602071366474133`*^9}, {3.8602072175390987`*^9, 
   3.8602072222251387`*^9}, {3.860207296599599*^9, 3.8602072992452803`*^9}, {
   3.8602083500323*^9, 3.8602083659769373`*^9}, {3.860208731415332*^9, 
   3.8602087544612637`*^9}, {3.860208822598855*^9, 3.860208849334097*^9}, {
   3.8602088927553864`*^9, 3.8602089096864758`*^9}, {3.8602090246657248`*^9, 
   3.860209032186109*^9}, {3.860209320669693*^9, 3.860209332367433*^9}, {
   3.860210410508503*^9, 3.8602104112391644`*^9}, {3.860210454568441*^9, 
   3.860210455075796*^9}, {3.860210897811323*^9, 3.860210938108015*^9}, {
   3.860212339130579*^9, 3.8602123694148607`*^9}, {3.860212573234593*^9, 
   3.860212580262816*^9}, {3.8602126276993933`*^9, 3.860212685214468*^9}, {
   3.860214232456373*^9, 3.860214233371771*^9}, {3.860214264475773*^9, 
   3.860214270326942*^9}, {3.8602161326267147`*^9, 3.8602161778076077`*^9}, {
   3.860217435630375*^9, 3.860217448454615*^9}, {3.860217586172454*^9, 
   3.860217649049274*^9}, {3.860218148144699*^9, 3.860218185831793*^9}, {
   3.860218238586129*^9, 3.860218287440052*^9}, {3.860218392022922*^9, 
   3.860218440031399*^9}, {3.860219210932509*^9, 3.860219212745241*^9}, {
   3.860219711310574*^9, 3.8602197513793793`*^9}, {3.860220605427143*^9, 
   3.860220642823111*^9}, {3.860220688135654*^9, 3.860220689066738*^9}, {
   3.860220824881404*^9, 3.860220902553841*^9}, {3.8602210588124943`*^9, 
   3.860221075608293*^9}, 3.860221485085731*^9, {3.860222041907236*^9, 
   3.8602220421130457`*^9}, 3.860222297950074*^9, 3.860222344101766*^9, {
   3.860222375169825*^9, 3.860222391413118*^9}, {3.8602224362383423`*^9, 
   3.860222443678467*^9}, {3.8602234264836063`*^9, 3.860223426839713*^9}, {
   3.8602278541019*^9, 3.860227854987639*^9}, 3.860284962635078*^9, {
   3.860285614095071*^9, 3.86028562253741*^9}, {3.8602871318155518`*^9, 
   3.860287143147476*^9}, 3.86028744217558*^9, {3.860287696294623*^9, 
   3.860287696422649*^9}, {3.8602887606024218`*^9, 3.86028876158119*^9}, 
   3.860288910584516*^9, {3.8602895662528543`*^9, 3.860289577299726*^9}, {
   3.86029954005562*^9, 3.860299541525279*^9}, {3.8602997331695957`*^9, 
   3.8602997437955303`*^9}, {3.860299799142846*^9, 3.860299799720539*^9}, {
   3.8602999029244003`*^9, 3.8602999174590187`*^9}, {3.860327514804967*^9, 
   3.860327520125806*^9}, {3.8603275910211453`*^9, 3.8603275926081443`*^9}, {
   3.860374167680387*^9, 3.8603741924428196`*^9}, {3.860374502534926*^9, 
   3.8603745114015603`*^9}, 3.860374579996482*^9, {3.860374768175445*^9, 
   3.8603747700448895`*^9}, {3.8603748313637905`*^9, 3.860374832154433*^9}, {
   3.860374942397807*^9, 3.860374959834628*^9}, 3.8603758992959557`*^9, {
   3.8603761494673004`*^9, 3.8603761543937817`*^9}, 3.860376266362576*^9, 
   3.860376313090335*^9, {3.860376430402449*^9, 3.8603764528258142`*^9}, 
   3.860376977545376*^9, {3.8603770904237766`*^9, 3.8603770923377*^9}, {
   3.860456437923841*^9, 3.860456438080551*^9}, {3.860456586721219*^9, 
   3.860456590122281*^9}, {3.860463804480878*^9, 3.86046380809543*^9}, {
   3.860464013703744*^9, 3.860464016814917*^9}, {3.860464089491105*^9, 
   3.860464089766498*^9}, {3.860482628851961*^9, 3.860482629052505*^9}, 
   3.860482765018351*^9, {3.860483138595643*^9, 3.860483139929064*^9}, {
   3.860562111644639*^9, 3.8605621139863997`*^9}, {3.860565940569488*^9, 
   3.860565944035548*^9}, {3.860634703959806*^9, 3.8606347043422117`*^9}, {
   3.860653453618987*^9, 3.860653453760915*^9}, {3.8607329618812923`*^9, 
   3.860732985973377*^9}, {3.860733050197941*^9, 3.860733067304315*^9}, 
   3.86074279206397*^9, {3.860823308230669*^9, 3.8608233263670397`*^9}, {
   3.860825730644806*^9, 3.86082574494748*^9}, {3.8608259914786673`*^9, 
   3.8608259927892017`*^9}, {3.860831773527731*^9, 3.860831790247485*^9}, {
   3.860838536342667*^9, 3.860838537175282*^9}, {3.861004328817567*^9, 
   3.861004329161153*^9}, {3.8610071591668577`*^9, 3.861007169359746*^9}, {
   3.8610636492676497`*^9, 3.8610636534815683`*^9}, {3.861063797086032*^9, 
   3.861063797682363*^9}, {3.861064361647167*^9, 3.8610643745761414`*^9}, {
   3.8610646985414257`*^9, 3.861064703253572*^9}, {3.8610648102076693`*^9, 
   3.8610648108509493`*^9}, {3.861064846662114*^9, 3.8610648472054567`*^9}, {
   3.861065423511853*^9, 3.861065478171164*^9}, 3.8610667370352583`*^9, {
   3.86106685267616*^9, 3.861066863964251*^9}, {3.861067131769352*^9, 
   3.861067136060689*^9}, {3.861067458869961*^9, 3.861067459495685*^9}, {
   3.861067520141142*^9, 3.861067530218338*^9}, 3.86106782687262*^9, {
   3.861067882280109*^9, 3.8610678848165293`*^9}, {3.8610689885457067`*^9, 
   3.861069025149515*^9}, {3.86106907122421*^9, 3.861069076957614*^9}, {
   3.861069622892316*^9, 3.8610696526337633`*^9}, {3.861070747856699*^9, 
   3.861070748013829*^9}, {3.861071583236356*^9, 3.8610715852859592`*^9}, {
   3.861072929716817*^9, 3.861072931666004*^9}, {3.861073686262233*^9, 
   3.861073735391424*^9}, 3.861073769430881*^9, {3.8610738976080313`*^9, 
   3.86107389823462*^9}, 3.8610740961623487`*^9, {3.861074130451312*^9, 
   3.8610741316074257`*^9}, {3.861074590743778*^9, 3.861074592063895*^9}, {
   3.8610748233416843`*^9, 3.861074825680069*^9}, {3.861075568933667*^9, 
   3.861075575519455*^9}, {3.861077938936901*^9, 3.861077957998909*^9}, {
   3.861078454129878*^9, 3.861078454211019*^9}, 3.861078574439198*^9, {
   3.8610954147059593`*^9, 3.8610954154366426`*^9}, {3.861172281356914*^9, 
   3.8611722822416897`*^9}, {3.861173698739937*^9, 3.8611737325993233`*^9}, {
   3.861173867765929*^9, 3.86117388868585*^9}, {3.861174181688898*^9, 
   3.861174212869123*^9}, {3.8611756546080303`*^9, 3.8611756553909063`*^9}, {
   3.861175747923526*^9, 3.861175764896572*^9}, {3.8611758282598877`*^9, 
   3.861175835069372*^9}, {3.8611759501481647`*^9, 3.861175954203023*^9}, {
   3.8611765061581287`*^9, 3.861176510905888*^9}, {3.861176564917385*^9, 
   3.861176619053913*^9}, {3.8611767226959476`*^9, 3.861176743270397*^9}, {
   3.861177454459285*^9, 3.861177498162795*^9}, {3.861178150380348*^9, 
   3.861178188737811*^9}, {3.861187109571533*^9, 3.861187109862892*^9}, {
   3.8611884040393248`*^9, 3.861188404363635*^9}, {3.861188475004731*^9, 
   3.861188477531282*^9}, {3.861190442941126*^9, 3.861190445810087*^9}, {
   3.861190507420192*^9, 3.861190538615386*^9}, {3.861190580135618*^9, 
   3.861190580821073*^9}, {3.861195427022732*^9, 3.861195557759948*^9}, {
   3.861195815008238*^9, 3.861195831443657*^9}, {3.861195870233761*^9, 
   3.861195942749667*^9}, {3.861195992047503*^9, 3.861196309276537*^9}, {
   3.861196433956959*^9, 3.861196435524267*^9}, 3.861196472938656*^9, {
   3.861196506295569*^9, 3.861196566271222*^9}, {3.861196613723009*^9, 
   3.861196659835767*^9}, {3.861196724733492*^9, 3.8611967316098413`*^9}, {
   3.861196807138989*^9, 3.8611968186990643`*^9}, {3.861196888845881*^9, 
   3.86119688971154*^9}, {3.861196946932749*^9, 3.861196961489202*^9}, {
   3.861196993413772*^9, 3.861197005586578*^9}, {3.861197042427704*^9, 
   3.8611970528281507`*^9}, 3.8611992447247477`*^9, {3.861345900587611*^9, 
   3.861345903104569*^9}, {3.861346484103734*^9, 3.861346570322319*^9}, {
   3.861346840725677*^9, 3.861346862751916*^9}, {3.861346966705147*^9, 
   3.8613470151732483`*^9}, {3.861347225695847*^9, 3.861347227966786*^9}, {
   3.8613481114328127`*^9, 3.8613481226668673`*^9}, {3.8613482534911203`*^9, 
   3.8613482806176777`*^9}, {3.861348341069291*^9, 3.8613483421224213`*^9}, 
   3.8613487576415854`*^9, {3.86134887120076*^9, 3.861348871366889*^9}, {
   3.861412340438422*^9, 3.861412389674898*^9}, {3.861412429508526*^9, 
   3.861412456221257*^9}, {3.8614126549018383`*^9, 3.8614126569862022`*^9}, {
   3.861412790608838*^9, 3.8614128310665503`*^9}, {3.861413037164219*^9, 
   3.861413037854835*^9}, {3.861413150312304*^9, 3.861413286683878*^9}, {
   3.861425079061204*^9, 3.861425175542067*^9}, {3.861425261287698*^9, 
   3.861425284046756*^9}, {3.861425881506794*^9, 3.861425917216343*^9}, {
   3.861511282462186*^9, 3.861511300026471*^9}, {3.861511331869439*^9, 
   3.861511355070067*^9}, {3.863569110780401*^9, 3.863569112329962*^9}, {
   3.866768495430353*^9, 3.866768520891786*^9}},
 CellTags->
  "CalculationFunctions",ExpressionUUID->"ab866a9e-9a86-42d8-9743-\
8ad7a09dea3d"],

Cell[BoxData[
 RowBox[{"(*", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"FKKSZ", "[", "solution_", "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ww", " ", "=", " ", 
           RowBox[{"solution", "[", 
            RowBox[{"[", 
             RowBox[{"\"\<Solution\>\"", ",", " ", "\"\<\[Omega]\>\""}], 
             "]"}], "]"}]}], ",", " ", "\[IndentingNewLine]", " \t", 
          RowBox[{"mm", " ", "=", " ", 
           RowBox[{"solution", "[", 
            RowBox[{"[", 
             RowBox[{"\"\<Parameters\>\"", ",", " ", "\"\<m\>\""}], "]"}], 
            "]"}]}], ",", "\[IndentingNewLine]", " \t", 
          RowBox[{"Sinterp", " ", "=", " ", 
           RowBox[{"solution", "[", 
            RowBox[{"[", 
             RowBox[{"\"\<Solution\>\"", ",", " ", "\"\<S(\[Theta])\>\""}], 
             "]"}], "]"}]}], ",", " ", "\[IndentingNewLine]", " \t", 
          RowBox[{"Rinterp", " ", "=", " ", 
           RowBox[{"Evaluate", "@", 
            RowBox[{"Function", "[", 
             RowBox[{
              RowBox[{"{", "r", "}"}], ",", 
              RowBox[{"Evaluate", "@", 
               RowBox[{
                RowBox[{"solution", "[", 
                 RowBox[{"[", 
                  RowBox[{"\"\<Solution\>\"", ",", "\"\<R(r)\>\""}], "]"}], 
                 "]"}], "[", 
                RowBox[{"RadialToHorizonCoord", "[", 
                 RowBox[{"r", ",", 
                  RowBox[{"solution", "[", 
                   RowBox[{"[", 
                    RowBox[{"\"\<Parameters\>\"", ",", "\"\<\[Chi]\>\""}], 
                    "]"}], "]"}]}], "]"}], "]"}]}]}], "]"}]}]}], ",", 
          "\[IndentingNewLine]", " \t", "res"}], "\[IndentingNewLine]", "\t", 
         "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"res", " ", "=", " ", 
          RowBox[{
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{"-", "I"}], "*", "ww", "*", "t"}], "]"}], "*", 
           RowBox[{"Rinterp", "[", "r", "]"}], "*", 
           RowBox[{"Sinterp", "[", "\[Theta]", "]"}], "*", 
           RowBox[{"Exp", "[", 
            RowBox[{"I", "*", "mm", "*", "\[Phi]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], 
          "\[Function]", " ", 
          RowBox[{"Evaluate", "[", "res", "]"}]}]}]}], "\[IndentingNewLine]", 
       "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"FKKSProca", "[", "U", "]"}], "[", "solution_", "]"}]}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"FKKSs", ",", " ", "res", ",", "AnalyticRes"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"FileExistsQ", "[", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                "\"\<Expressions\>\"", ",", " ", "\"\<FKKSProcaU.mx\>\""}], 
               "}"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"(*", "True", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"AnalyticRes", " ", "=", " ", 
              RowBox[{"Import", "[", 
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                  "\"\<Expressions\>\"", ",", " ", "\"\<FKKSProcaU.mx\>\""}], 
                 "}"}], "]"}], "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", "False", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"FKKSs", " ", "=", " ", 
              RowBox[{
               RowBox[{"FKKSZ", "[", "AnalyticSolution", "]"}], "[", 
               RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"AnalyticRes", " ", "=", 
              RowBox[{
               RowBox[{"Simplify", "[", 
                RowBox[{"PolarizationComponents", ".", 
                 RowBox[{
                  SubscriptBox["\[PartialD]", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                    "}"}], ",", "1"}], "}"}]], 
                  RowBox[{"(", "FKKSs", ")"}]}]}], "]"}], "//", 
               RowBox[{"ApplySolutionSet", "[", "solution", "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Export", "[", 
              RowBox[{
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                  "\"\<Expressions\>\"", ",", " ", "\"\<FKKSProcaU.mx\>\""}], 
                 "}"}], "]"}], ",", " ", "AnalyticRes"}], "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"res", " ", "=", " ", 
           RowBox[{"AnalyticRes", "//", 
            RowBox[{"ApplySolutionSet", "[", "solution", "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], 
           "\[Function]", " ", 
           RowBox[{"Evaluate", "[", "res", "]"}]}]}]}], "\[IndentingNewLine]",
         "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"FKKSProca", "[", "L", "]"}], "[", "solution_", "]"}]}], ":=",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"tmp", ",", "res", ",", "g", ",", "AnalyticRes"}], "}"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"FileExistsQ", "[", 
              RowBox[{"FileNameJoin", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                 "\"\<Expressions\>\"", ",", " ", "\"\<FKKSProcaL.mx\>\""}], 
                "}"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", "True", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AnalyticRes", " ", "=", " ", 
               RowBox[{"Import", "[", 
                RowBox[{"FileNameJoin", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                   "\"\<Expressions\>\"", ",", " ", "\"\<FKKSProcaL.mx\>\""}],
                   "}"}], "]"}], "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", "False", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"g", "=", "KerrComponents"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"tmp", " ", "=", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"FKKSProca", "[", "U", "]"}], "[", 
                 "AnalyticSolution", "]"}], "[", 
                RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"AnalyticRes", " ", "=", 
               RowBox[{"Simplify", "[", 
                RowBox[{"g", ".", "tmp"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Export", "[", 
               RowBox[{
                RowBox[{"FileNameJoin", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                   "\"\<Expressions\>\"", ",", " ", "\"\<FKKSProcaL.mx\>\""}],
                   "}"}], "]"}], ",", " ", "AnalyticRes"}], "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"res", " ", "=", " ", 
            RowBox[{"AnalyticRes", "//", 
             RowBox[{"ApplySolutionSet", "[", "solution", "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], 
            "\[Function]", " ", 
            RowBox[{"Evaluate", "[", "res", "]"}]}]}]}], 
         "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"FKKSFieldStrength", "::", "usage"}]}], "=", 
       "\"\<Computes field strength tensor of proca field for various index \
structures\>\""}]}]}]}], ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FKKSFieldStrength", "[", "LL", "]"}], "[", "solution_", "]"}], ":=",
     "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"tmp", ",", " ", "res", ",", "AnalyticRes"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"FileExistsQ", "[", 
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
               "\"\<Expressions\>\"", ",", " ", 
               "\"\<FKKSFieldStrengthLL.mx\>\""}], "}"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", "True", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AnalyticRes", " ", "=", " ", 
             RowBox[{"Import", "[", 
              RowBox[{"FileNameJoin", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                 "\"\<Expressions\>\"", ",", " ", 
                 "\"\<FKKSFieldStrengthLL.mx\>\""}], "}"}], "]"}], "]"}]}], 
            ";"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", "False", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"tmp", " ", "=", "  ", 
             RowBox[{"Transpose", "[", 
              RowBox[{
               SubscriptBox["\[PartialD]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                   "}"}], ",", "1"}], "}"}]], 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"FKKSProca", "[", "L", "]"}], "[", 
                  "AnalyticSolution", "]"}], "[", 
                 RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                 "]"}], ")"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"AnalyticRes", " ", "=", " ", 
             RowBox[{"Simplify", "[", 
              RowBox[{
               RowBox[{"Rationalize", "[", 
                RowBox[{
                 RowBox[{"tmp", " ", "-", " ", 
                  RowBox[{"Transpose", "[", "tmp", "]"}]}], ",", "0"}], "]"}],
                ",", " ", 
               RowBox[{"TimeConstraint", "\[Rule]", "Infinity"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Export", "[", 
             RowBox[{
              RowBox[{"FileNameJoin", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                 "\"\<Expressions\>\"", ",", " ", 
                 "\"\<FKKSFieldStrengthLL.mx\>\""}], "}"}], "]"}], ",", " ", 
              "AnalyticRes"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"res", " ", "=", " ", 
          RowBox[{"AnalyticRes", "//", 
           RowBox[{"ApplySolutionSet", "[", "solution", "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], 
          "\[Function]", 
          RowBox[{"Evaluate", "[", "res", "]"}]}]}]}], "\[IndentingNewLine]", 
       "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"FKKSFieldStrength", "[", "UU", "]"}], "[", "solution_", 
       "]"}]}], ":=", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"tmp", ",", "res", ",", "ig", ",", " ", "AnalyticRes"}], 
          "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"FileExistsQ", "[", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                "\"\<Expressions\>\"", ",", " ", 
                "\"\<FKKSFieldStrengthUU.mx\>\""}], "}"}], "]"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", "true", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"AnalyticRes", " ", "=", " ", 
              RowBox[{"Import", "[", 
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                  "\"\<Expressions\>\"", ",", " ", 
                  "\"\<FKKSFieldStrengthUU.mx\>\""}], "}"}], "]"}], "]"}]}], 
             ";"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", "false", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"ig", " ", "=", " ", 
              RowBox[{"Simplify", "[", "IKerrComponents", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"tmp", " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"FKKSFieldStrength", "[", "LL", "]"}], "[", 
                "AnalyticSolution", "]"}], "[", 
               RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"AnalyticRes", " ", "=", " ", 
              RowBox[{"Simplify", "[", 
               RowBox[{
                RowBox[{"ig", ".", "tmp", ".", 
                 RowBox[{"Transpose", "[", "ig", "]"}]}], ",", " ", 
                RowBox[{"TimeConstraint", "\[Rule]", "Infinity"}]}], "]"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"Export", "[", 
              RowBox[{
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                  "\"\<Expressions\>\"", ",", " ", 
                  "\"\<FKKSFieldStrengthUU.mx\>\""}], "}"}], "]"}], ",", " ", 
               "AnalyticRes"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"res", " ", "=", " ", 
           RowBox[{"AnalyticRes", "//", 
            RowBox[{"ApplySolutionSet", "[", "solution", "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], 
           "\[Function]", 
           RowBox[{"Evaluate", "[", "res", "]"}]}]}]}], "\[IndentingNewLine]",
         "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"FKKSFieldStrength", "[", "UL", "]"}], "[", "solution_", 
        "]"}]}], ":=", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"tmp", ",", "res", ",", "ig", ",", "AnalyticRes"}], "}"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"FileExistsQ", "[", 
              RowBox[{"FileNameJoin", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                 "\"\<Expressions\>\"", ",", " ", 
                 "\"\<FKKSFieldStrengthUL.mx\>\""}], "}"}], "]"}], "]"}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"(*", "true", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AnalyticRes", " ", "=", " ", 
               RowBox[{"Import", "[", 
                RowBox[{"FileNameJoin", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                   "\"\<Expressions\>\"", ",", " ", 
                   "\"\<FKKSFieldStrengthUL.mx\>\""}], "}"}], "]"}], "]"}]}], 
              ";"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", "false", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ig", " ", "=", " ", 
               RowBox[{"Simplify", "[", "IKerrComponents", "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"tmp", " ", "=", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"FKKSFieldStrength", "[", "LL", "]"}], "[", 
                 "AnalyticSolution", "]"}], "[", 
                RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"AnalyticRes", " ", "=", " ", 
               RowBox[{"Simplify", "[", 
                RowBox[{
                 RowBox[{"ig", ".", "tmp"}], ",", " ", 
                 RowBox[{"TimeConstraint", "\[Rule]", "Infinity"}]}], "]"}]}],
               ";", "\[IndentingNewLine]", 
              RowBox[{"Export", "[", 
               RowBox[{
                RowBox[{"FileNameJoin", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                   "\"\<Expressions\>\"", ",", " ", 
                   "\"\<FKKSFieldStrengthUL.mx\>\""}], "}"}], "]"}], ",", " ",
                 "AnalyticRes"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"res", " ", "=", " ", 
            RowBox[{"AnalyticRes", "//", 
             RowBox[{"ApplySolutionSet", "[", "solution", "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], 
            "\[Function]", 
            RowBox[{"Evaluate", "[", "res", "]"}]}]}]}], 
         "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"FKKSEnergyMomentum", "::", "usage"}]}], "=", 
       "\"\<Compute Energy Momentum tensor for given solution set for various \
index structures.\>\""}]}]}]}], ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FKKSEnergyMomentum", "[", "UU", "]"}], "[", 
     RowBox[{"solution_", ",", " ", 
      RowBox[{"OutputForm_", ":", 
       RowBox[{"<|", 
        RowBox[{"\"\<SymbolicExpression\>\"", "->", "False"}], "|>"}]}]}], 
     "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "tmp", ",", "res", ",", "Fll", ",", "Fuu", ",", "Ful", ",", "Al", 
          ",", "Au", ",", "ig", ",", "g", ",", "\[Mu]", ",", " ", 
          "AnalyticRes", ",", "OptimizedResult", ",", " ", "resOE"}], "}"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"FileExistsQ", "[", 
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
               "\"\<Expressions\>\"", ",", " ", 
               "\"\<FKKSEnergyMomentumUU.mx\>\""}], "}"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", "true", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AnalyticRes", " ", "=", " ", 
             RowBox[{"Import", "[", 
              RowBox[{"FileNameJoin", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                 "\"\<Expressions\>\"", ",", " ", 
                 "\"\<FKKSEnergyMomentumUU.mx\>\""}], "}"}], "]"}], "]"}]}], 
            ";"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", "false", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\[Mu]", "=", 
             RowBox[{"solution", "[", 
              RowBox[{"\"\<Parameters\>\"", ",", " ", "\"\<\[Mu]Nv\>\""}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"ig", " ", "=", " ", 
             RowBox[{"Simplify", "[", 
              RowBox[{"Inverse", "[", "KerrComponents", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"g", " ", "=", " ", "KerrComponents"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Fll", " ", "=", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"FKKSFieldStrength", "[", "LL", "]"}], "[", 
               "AnalyticSolution", "]"}], "[", 
              RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Ful", " ", "=", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"FKKSFieldStrength", "[", "UL", "]"}], "[", 
               "AnalyticSolution", "]"}], "[", 
              RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Fuu", " ", "=", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"FKKSFieldStrength", "[", "UU", "]"}], "[", 
               "AnalyticSolution", "]"}], "[", 
              RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Al", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"FKKSProca", "[", "L", "]"}], "[", "AnalyticSolution", 
               "]"}], "[", 
              RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Au", " ", "=", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"FKKSProca", "[", "U", "]"}], "[", "AnalyticSolution", 
               "]"}], "[", 
              RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"AnalyticRes", " ", "=", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  FractionBox[
                   RowBox[{"-", "1"}], "4"], "ig", "*", 
                  RowBox[{"Tr", "[", 
                   RowBox[{"Fll", ".", "Fuu"}], "]"}]}], " ", "-", 
                 RowBox[{"Fuu", ".", "g", ".", "Fuu"}], " ", "+", " ", 
                 RowBox[{
                  FractionBox[
                   SuperscriptBox["\[Mu]", "2"], "2"], "ig", "*", 
                  RowBox[{"Al", ".", "Au"}]}], " ", "+", 
                 RowBox[{
                  SuperscriptBox["\[Mu]", "2"], "*", 
                  RowBox[{"Au", "\[TensorProduct]", "Au"}]}]}], ")"}]}], 
              ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"AnalyticRes", " ", "=", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                FractionBox[
                 RowBox[{"-", "1"}], "4"], "ig", "*", 
                RowBox[{"(", 
                 RowBox[{"Tr", "[", 
                  RowBox[{"Fll", ".", 
                   RowBox[{"Transpose", "[", "Fuu", "]"}]}], "]"}], ")"}]}], 
               " ", "+", 
               RowBox[{"(", 
                RowBox[{"Fuu", ".", "g", ".", 
                 RowBox[{"Transpose", "[", "Fuu", "]"}]}], ")"}], " ", "-", 
               " ", 
               RowBox[{
                FractionBox[
                 SuperscriptBox["\[Mu]", "2"], "2"], "ig", "*", 
                RowBox[{"Al", ".", "Au"}]}], " ", "+", 
               RowBox[{
                SuperscriptBox["\[Mu]", "2"], "*", 
                RowBox[{"Au", "\[TensorProduct]", "Au"}]}]}], ")"}]}], ";", 
            " ", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"S", "&"}], "E", " ", "expression"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"Export", "[", 
             RowBox[{
              RowBox[{"FileNameJoin", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                 "\"\<Expressions\>\"", ",", " ", 
                 "\"\<FKKSEnergyMomentumUU.mx\>\""}], "}"}], "]"}], ",", " ", 
              "AnalyticRes"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"res", " ", "=", " ", 
          RowBox[{"AnalyticRes", "//", 
           RowBox[{"ApplySolutionSet", "[", "solution", "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"resOE", " ", "=", " ", 
          RowBox[{"Experimental`OptimizeExpression", "[", 
           RowBox[{"res", ",", " ", 
            RowBox[{"OptimizationSymbol", "->", "a"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"OptimizedResult", " ", "=", " ", 
          RowBox[{"resOE", "/.", 
           RowBox[{
            RowBox[{"Experimental`OptimizedExpression", "[", "f_", "]"}], ":>", 
            RowBox[{"Function", "@@", 
             RowBox[{"Hold", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                "}"}], ",", " ", "f"}], "]"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"OutputForm", "[", "\"\<SymbolicExpression\>\"", "]"}], 
           ",", " ", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], "|->",
             " ", 
            RowBox[{"Evaluate", "[", "res", "]"}]}], ",", " ", 
           "OptimizedResult"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"FKKSEnergyMomentum", "[", "UL", "]"}], "[", 
       RowBox[{"solution_", ",", " ", 
        RowBox[{"OutputForm_", ":", 
         RowBox[{"<|", 
          RowBox[{"\"\<SymbolicExpression\>\"", "->", "False"}], "|>"}]}]}], 
       "]"}]}], ":=", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "tmp", ",", "res", ",", "g", ",", "AnalyticRes", ",", " ", 
           "OptimizedResult", ",", " ", "resOE"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"FileExistsQ", "[", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                "\"\<Expressions\>\"", ",", " ", 
                "\"\<FKKSEnergyMomentumUL.mx\>\""}], "}"}], "]"}], "]"}], ",",
             "\[IndentingNewLine]", 
            RowBox[{"(*", "true", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"AnalyticRes", " ", "=", " ", 
              RowBox[{"Import", "[", 
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                  "\"\<Expressions\>\"", ",", " ", 
                  "\"\<FKKSEnergyMomentumUL.mx\>\""}], "}"}], "]"}], "]"}]}], 
             ";"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", "false", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"g", " ", "=", " ", "KerrComponents"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"tmp", " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"FKKSEnergyMomentum", "[", "UU", "]"}], "[", 
                RowBox[{"AnalyticSolution", ",", " ", 
                 RowBox[{"<|", 
                  RowBox[{"\"\<SymbolicExpression\>\"", "->", "True"}], 
                  "|>"}]}], "]"}], "[", 
               RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"AnalyticRes", " ", "=", " ", 
              RowBox[{"tmp", ".", "g"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"Export", "[", 
              RowBox[{
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                  "\"\<Expressions\>\"", ",", " ", 
                  "\"\<FKKSEnergyMomentumUL.mx\>\""}], "}"}], "]"}], ",", " ",
                "AnalyticRes"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"res", " ", "=", " ", 
           RowBox[{"AnalyticRes", "//", 
            RowBox[{"ApplySolutionSet", "[", "solution", "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"resOE", " ", "=", " ", 
           RowBox[{"Experimental`OptimizeExpression", "[", 
            RowBox[{"res", ",", " ", 
             RowBox[{"OptimizationSymbol", "->", "a"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"OptimizedResult", " ", "=", " ", 
           RowBox[{"resOE", "/.", 
            RowBox[{
             RowBox[{"Experimental`OptimizedExpression", "[", "f_", "]"}], ":>", 
             RowBox[{"Function", "@@", 
              RowBox[{"Hold", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                 "}"}], ",", " ", "f"}], "]"}]}]}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"OutputForm", "[", "\"\<SymbolicExpression\>\"", "]"}], 
            ",", " ", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], 
             "|->", " ", 
             RowBox[{"Evaluate", "[", "res", "]"}]}], ",", " ", 
            "OptimizedResult"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"FKKSEnergyMomentum", "[", "LL", "]"}], "[", 
        RowBox[{"solution_", ",", " ", 
         RowBox[{"OutputForm_", ":", 
          RowBox[{"<|", 
           RowBox[{"\"\<SymbolicExpression\>\"", "->", "False"}], "|>"}]}]}], 
        "]"}]}], ":=", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "tmp", ",", "res", ",", "g", ",", "AnalyticRes", ",", " ", "resOE",
             ",", " ", "OptimizedResult"}], "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"FileExistsQ", "[", 
              RowBox[{"FileNameJoin", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                 "\"\<Expressions\>\"", ",", " ", 
                 "\"\<FKKSEnergyMomentumLL.mx\>\""}], "}"}], "]"}], "]"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"(*", "true", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AnalyticRes", " ", "=", " ", 
               RowBox[{"Import", "[", 
                RowBox[{"FileNameJoin", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                   "\"\<Expressions\>\"", ",", " ", 
                   "\"\<FKKSEnergyMomentumLL.mx\>\""}], "}"}], "]"}], "]"}]}],
               ";"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", "false", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"g", " ", "=", " ", "KerrComponents"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"tmp", " ", "=", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"FKKSEnergyMomentum", "[", "UU", "]"}], "[", 
                 RowBox[{"AnalyticSolution", ",", " ", 
                  RowBox[{"<|", 
                   RowBox[{"\"\<SymbolicExpression\>\"", "->", "True"}], 
                   "|>"}]}], "]"}], "[", 
                RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"AnalyticRes", " ", "=", " ", 
               RowBox[{"g", ".", "tmp", ".", "g"}]}], ";", 
              RowBox[{"Export", "[", 
               RowBox[{
                RowBox[{"FileNameJoin", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                   "\"\<Expressions\>\"", ",", " ", 
                   "\"\<FKKSEnergyMomentumLL.mx\>\""}], "}"}], "]"}], ",", 
                " ", "AnalyticRes"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"res", " ", "=", " ", 
            RowBox[{"AnalyticRes", "//", 
             RowBox[{"ApplySolutionSet", "[", "solution", "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"resOE", " ", "=", " ", 
            RowBox[{"Experimental`OptimizeExpression", "[", 
             RowBox[{"res", ",", " ", 
              RowBox[{"OptimizationSymbol", "->", "a"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"OptimizedResult", " ", "=", " ", 
            RowBox[{"resOE", "/.", 
             RowBox[{
              RowBox[{"Experimental`OptimizedExpression", "[", "f_", "]"}], ":>", 
              RowBox[{"Function", "@@", 
               RowBox[{"Hold", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                  "}"}], ",", " ", "f"}], "]"}]}]}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"OutputForm", "[", "\"\<SymbolicExpression\>\"", "]"}], 
             ",", " ", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}],
               "|->", " ", 
              RowBox[{"Evaluate", "[", "res", "]"}]}], ",", " ", 
             "OptimizedResult"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"FKKSEnergyDensity", "[", 
         RowBox[{"solution_", ",", " ", 
          RowBox[{"OutputForm_", ":", 
           RowBox[{"<|", 
            RowBox[{"\"\<SymbolicExpression\>\"", "->", "False"}], "|>"}]}]}],
          "]"}]}], ":=", "\[IndentingNewLine]", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "AnalyticRes", ",", " ", "res", ",", " ", "resOE", ",", " ", 
           "OptimizedResult"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"FileExistsQ", "[", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                "\"\<Expressions\>\"", ",", " ", 
                "\"\<FKKSEnergyDensity.mx\>\""}], "}"}], "]"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", "true", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"AnalyticRes", " ", "=", " ", 
              RowBox[{"Import", "[", 
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                  "\"\<Expressions\>\"", ",", " ", 
                  "\"\<FKKSEnergyDensity.mx\>\""}], "}"}], "]"}], "]"}]}], 
             ";"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", "false", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"AnalyticRes", " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"-", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"FKKSEnergyMomentum", "[", "UL", "]"}], "[", 
                   RowBox[{"AnalyticSolution", ",", " ", 
                    RowBox[{"<|", 
                    RowBox[{"\"\<SymbolicExpression\>\"", "->", "True"}], 
                    "|>"}]}], "]"}], "[", 
                  RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                  "]"}]}], "//", "First"}], "//", "First"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Export", "[", 
              RowBox[{
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"NotebookDirectory", "[", "]"}], ",", " ", 
                  "\"\<Expressions\>\"", ",", " ", 
                  "\"\<FKKSEnergyDensity.mx\>\""}], "}"}], "]"}], ",", " ", 
               "AnalyticRes"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"res", " ", "=", " ", 
           RowBox[{"AnalyticRes", "//", 
            RowBox[{"ApplySolutionSet", "[", "solution", "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"resOE", " ", "=", " ", 
           RowBox[{"Experimental`OptimizeExpression", "[", 
            RowBox[{"res", ",", " ", 
             RowBox[{"OptimizationSymbol", "->", "a"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"OptimizedResult", " ", "=", " ", 
           RowBox[{"resOE", "/.", 
            RowBox[{
             RowBox[{"Experimental`OptimizedExpression", "[", "f_", "]"}], ":>", 
             RowBox[{"Function", "@@", 
              RowBox[{"Hold", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], 
                 "}"}], ",", " ", "f"}], "]"}]}]}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"OutputForm", "[", "\"\<SymbolicExpression\>\"", "]"}], 
            ",", " ", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"t", ",", "r", ",", "\[Theta]", ",", "\[Phi]"}], "}"}], 
             "|->", " ", 
             RowBox[{"Evaluate", "[", "res", "]"}]}], ",", " ", 
            "OptimizedResult"}], "]"}]}]}], "\[IndentingNewLine]", 
        "]"}]}]}]}]}]}], "\[IndentingNewLine]", "*)"}]], "Input",ExpressionUUI\
D->"b427287e-6470-4bd2-96fe-d8b7e07f5bb0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["        Package Functions", "Subsection",
 CellChangeTimes->{{3.860198747935575*^9, 3.860198748606625*^9}, {
  3.8602848790395737`*^9, 3.8602848793456984`*^9}, {3.862138951636338*^9, 
  3.862138953587615*^9}},ExpressionUUID->"518c50da-c7a6-45eb-8b1f-\
e2749f381851"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FineMinimize", "[", 
    RowBox[{
     RowBox[{"RoughMinimizationResults_", "?", "AssociationQ"}], ",", " ", 
     RowBox[{"OmegaBoundary_", "?", "ListQ"}], ",", " ", 
     RowBox[{"parameters_", "?", "AssociationQ"}], ",", " ", 
     RowBox[{"Watcher_", ":", "False"}]}], "]"}], ":=", "\n", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\n", "\n", 
     RowBox[{
      RowBox[{"guess", "=", 
       RowBox[{"RoughMinimizationResults", "[", "\"\<\[Omega]\>\"", "]"}]}], 
      ";", "\n", 
      RowBox[{"SimplexBase", " ", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"guess", "//", "Re"}], ",", " ", 
          RowBox[{"guess", "//", "Im"}]}], "}"}], "//", " ", 
        RowBox[{"ToPrecision", "[", "parameters", "]"}]}]}], ";", "\n", 
      RowBox[{"SimplexNodeOne", " ", "=", " ", 
       RowBox[{"SimplexBase", "-", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"OmegaBoundary", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "-", "guess"}], ")"}], "/", 
            RowBox[{"parameters", "[", "\"\<omegaRes\>\"", "]"}]}], "//", 
           "Re"}], ",", "0"}], "}"}]}]}], ";", "\n", 
      RowBox[{"SimplexNodeTwo", " ", "=", " ", 
       RowBox[{"SimplexBase", " ", "-", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", " ", 
          RowBox[{"10", "^", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Log10", "[", 
              RowBox[{"Abs", "@", 
               RowBox[{"Im", "[", "guess", "]"}]}], "]"}], "-", "1"}], 
            ")"}]}]}], "}"}]}]}], ";", "\n", 
      RowBox[{"InitialSimplex", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
        "SimplexBase", ",", " ", "SimplexNodeOne", ",", " ", 
         "SimplexNodeTwo"}], "}"}]}], ";", "\n", 
      RowBox[{"Minimizer", " ", "=", " ", 
       RowBox[{"NelderMead2D", "[", 
        RowBox[{
         RowBox[{"functomin", "[", "parameters", "]"}], ",", " ", 
         "InitialSimplex", ",", 
         RowBox[{"10", "^", 
          RowBox[{"-", 
           RowBox[{
           "parameters", "[", "\"\<OptimizationPrecision\>\"", "]"}]}]}], ",", 
         RowBox[{"10", "^", 
          RowBox[{"-", 
           RowBox[{
           "parameters", "[", "\"\<OptimizationAccuracy\>\"", "]"}]}]}], ",", 
         " ", "Watcher"}], "]"}]}], ";", "\n", 
      RowBox[{"omegaval", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Minimizer", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "//", "R2toC"}], "//", 
        RowBox[{"ToPrecision", "[", "parameters", "]"}]}]}], ";", "\n", 
      RowBox[{"nuval", " ", "=", " ", 
       RowBox[{
        RowBox[{"getNuValue", "[", 
         RowBox[{"omegaval", ",", " ", "parameters", ",", 
          RowBox[{"nuNNonRel", "[", 
           RowBox[{"omegaval", ",", "parameters"}], "]"}]}], "]"}], "//", 
        RowBox[{"ToPrecision", "[", "parameters", "]"}]}]}], ";", "\n", 
      RowBox[{"FineMinimizationResults", " ", "=", " ", 
       RowBox[{"<|", 
        RowBox[{
         RowBox[{"\"\<\[Omega]\>\"", "->", " ", "omegaval"}], ",", " ", 
         RowBox[{"\"\<\[Nu]\>\"", "->", "nuval"}]}], " ", "|>"}]}]}]}], "\n", 
    "]"}]}], ";"}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"433b2a71-144e-4207-9bad-82ae40d9be12"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Nelder", " ", "Mead", " ", "optimization", " ", "algorithm"}], 
   "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"NelderMead2D", "[", 
     RowBox[{
      RowBox[{"objFunc_", "?", "SymbolQ"}], ",", 
      RowBox[{"initialSimplex_", "?", "ListQ"}], ",", 
      RowBox[{"Precisiongoal_", "?", "NumberQ"}], ",", " ", 
      RowBox[{"Accuracygoal_", "?", "NumberQ"}], ",", " ", 
      RowBox[{"Watcher_", ":", "False"}]}], "]"}], ":=", "\n", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\[Alpha]", "=", "1"}], ",", 
        RowBox[{"\[Beta]", "=", "2"}], ",", 
        RowBox[{"\[Rho]", "=", 
         RowBox[{"1", "/", "2"}]}], ",", " ", 
        RowBox[{"\[Sigma]nm", "=", 
         RowBox[{"1", "/", "2"}]}]}], "}"}], ",", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Evaluate", " ", "objective", " ", "function", " ", "on", " ", 
        "initial", " ", "simplex"}], "*)"}], "\n", 
      RowBox[{
       RowBox[{"currentFuncValues", " ", "=", " ", 
        RowBox[{"objFunc", "/@", "initialSimplex"}]}], ";", "\n", 
       RowBox[{"currentSimplex", " ", "=", " ", "initialSimplex"}], ";", "\n", 
       RowBox[{"\[Omega]deltaHolder", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0"}], "}"}]}], ";", 
       "\n", 
       RowBox[{"FdeltaHolder", "=", 
        RowBox[{"{", "0", "}"}]}], ";", "\n", "\n", 
       RowBox[{"NMCounter", " ", "=", " ", "1"}], ";", "\n", 
       RowBox[{"NMSnooper", " ", "=", " ", "0"}], ";", "\n", 
       RowBox[{"NMSnooper2", "=", "0"}], ";", "\n", 
       RowBox[{"NMStepWatcher", "=", "\"\<\>\""}], ";", "\n", 
       RowBox[{"If", "[", 
        RowBox[{"Watcher", ",", " ", 
         RowBox[{"Print", "@", 
          RowBox[{"Dynamic", "[", 
           RowBox[{"\"\<[FineMinimization] Iteration number: \>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NMCounter", ",", " ", "InputForm"}], "]"}], "<>", 
            "\"\<\\nCurrent Best Value: \>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NMSnooper", ",", " ", "InputForm"}], "]"}], "<>", 
            "\"\<\\nCurrent Deltas: \>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NMSnooper2", ",", " ", "InputForm"}], "]"}], "<>", 
            "\"\<\\nAt Step \>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"NMStepWatcher", ",", " ", "InputForm"}], "]"}]}], 
           "]"}]}]}], "]"}], ";", "\n", "\n", 
       RowBox[{"(*", 
        RowBox[{
        "Define", " ", "termination", " ", "conditions", " ", "for", " ", 
         "loop"}], "*)"}], "\n", 
       RowBox[{"PrecisionTerminator", " ", "=", " ", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "funcvals", "}"}], ",", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Max", "[", "funcvals", "]"}], "-", 
             RowBox[{"Min", "[", "funcvals", "]"}]}], ")"}], "<", 
           "Precisiongoal"}]}], "]"}]}], ";", "\n", 
       RowBox[{"AccuracyTerminator", " ", "=", " ", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "simplex", "}"}], ",", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Max", "[", 
              RowBox[{"Norm", "/@", "simplex"}], "]"}], "-", 
             RowBox[{"Min", "[", 
              RowBox[{"Norm", "/@", "simplex"}], "]"}]}], ")"}], "<", 
           "Accuracygoal"}]}], "]"}]}], ";", "\n", 
       RowBox[{"DeltaTerminator", " ", "=", " ", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "deltaholder", "}"}], ",", " ", 
          RowBox[{"AllTrue", "[", 
           RowBox[{
            RowBox[{"deltaholder", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"-", "5"}], ";;", 
               RowBox[{"-", "1"}]}], "]"}], "]"}], ",", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"#", "==", 
               RowBox[{"deltaholder", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}]}], ")"}], "&"}]}], "]"}]}], 
         "]"}]}], ";", "\n", 
       RowBox[{"PrecisionTermination", " ", "=", " ", "False"}], ";", "\n", 
       RowBox[{"AccuracyTermination", " ", "=", " ", "False"}], ";", "\n", 
       RowBox[{"DeltaTermination", " ", "=", " ", "False"}], ";", "\n", "\n", 
       
       RowBox[{"(*", 
        RowBox[{"begin", " ", "algorithm"}], "*)"}], "\n", 
       RowBox[{"While", "[", "\n", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"\[Not]", "PrecisionTermination"}], ")"}], " ", "&&", " ", 
          
          RowBox[{"(", 
           RowBox[{"\[Not]", "AccuracyTermination"}], ")"}], " ", "&&", " ", 
          RowBox[{"(", 
           RowBox[{"\[Not]", "DeltaTermination"}], ")"}]}], ",", "\n", "\n", 
         RowBox[{"(*", 
          RowBox[{
          "Order", " ", "objective", " ", "function", " ", "on", " ", 
           "simplex"}], "*)"}], "\n", 
         RowBox[{
          RowBox[{"orderingIndicies", " ", "=", " ", 
           RowBox[{"Ordering", "[", "currentFuncValues", "]"}]}], ";", "\n", 
          RowBox[{"orderedcurrentFuncValues", " ", "=", " ", 
           RowBox[{"currentFuncValues", "[", 
            RowBox[{"[", "orderingIndicies", "]"}], "]"}]}], ";", "\n", 
          RowBox[{"orderedcurrentSimplex", " ", "=", " ", 
           RowBox[{"currentSimplex", "[", 
            RowBox[{"[", "orderingIndicies", "]"}], "]"}]}], ";", "\n", 
          RowBox[{"BestPoint", " ", "=", " ", 
           RowBox[{"orderedcurrentSimplex", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
          RowBox[{"WorstPoint", " ", "=", " ", 
           RowBox[{"orderedcurrentSimplex", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], ";", "\n", 
          RowBox[{"MiddlePoint", " ", "=", " ", 
           RowBox[{"orderedcurrentSimplex", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ";", "\n", 
          RowBox[{"BestValue", " ", "=", " ", 
           RowBox[{"orderedcurrentFuncValues", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
          RowBox[{"MiddleValue", " ", "=", " ", 
           RowBox[{"orderedcurrentFuncValues", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ";", "\n", 
          RowBox[{"WorstValue", " ", "=", " ", 
           RowBox[{"orderedcurrentFuncValues", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], ";", "\n", "\n", 
          RowBox[{"currentCentroid", " ", "=", " ", 
           RowBox[{
            RowBox[{"1", "/", "2"}], "*", 
            RowBox[{"(", 
             RowBox[{"BestPoint", " ", "+", " ", "MiddlePoint"}], ")"}]}]}], 
          ";", "\n", "\n", 
          RowBox[{"currentTrialPoint", " ", "=", " ", 
           RowBox[{"currentCentroid", " ", "+", 
            RowBox[{"\[Alpha]", "*", 
             RowBox[{"(", 
              RowBox[{"currentCentroid", " ", "-", " ", "WorstPoint"}], 
              ")"}]}]}]}], ";", " ", "\n", 
          RowBox[{"(*", 
           RowBox[{
           "Reflection", " ", "of", " ", "worst", " ", "point", " ", "across",
             " ", "centroid"}], "*)"}], "\n", 
          RowBox[{"currentTrialValue", " ", "=", " ", 
           RowBox[{"objFunc", "@", "currentTrialPoint"}]}], ";", "\n", "\n", 
          RowBox[{"(*", "Reflection", "*)"}], "\n", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "If", " ", "new", " ", "funcvalue", " ", "is", " ", "not", " ", 
             "the", " ", "worst", " ", "or", " ", "the", " ", "best"}], ",", 
            " ", 
            RowBox[{
            "replace", " ", "current", " ", "worst", " ", "by", " ", "trial", 
             " ", "point"}]}], "*)"}], "\n", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
            "BestValue", "<=", "currentTrialValue", "<", "MiddleValue"}], ",",
             "\n", "\t", 
            RowBox[{
             RowBox[{"NewSimplex", " ", "=", " ", 
              RowBox[{"ReplacePart", "[", 
               RowBox[{"orderedcurrentSimplex", ",", 
                RowBox[{"3", "->", " ", "currentTrialPoint"}]}], "]"}]}], ";",
              "\n", "\t", 
             RowBox[{"Goto", "[", "LoopEnd", "]"}], ";"}]}], "\n", "]"}], ";",
           "\n", "\n", 
          RowBox[{"(*", "Expansion", "*)"}], "\n", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "if", " ", "new", " ", "funcvalue", " ", "is", " ", "the", " ", 
             "best", " ", "so", " ", "far"}], ",", " ", 
            RowBox[{"perform", " ", "expansion"}]}], "*)"}], "\n", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"currentTrialValue", "<", "BestValue"}], ",", "\n", 
            RowBox[{
             RowBox[{"NMStepWatcher", "=", "\"\<Expansion\>\""}], ";", "\n", 
             RowBox[{"expansionPoint", " ", "=", " ", 
              RowBox[{"currentCentroid", " ", "+", " ", 
               RowBox[{"\[Beta]", "*", 
                RowBox[{"(", 
                 RowBox[{
                 "currentTrialPoint", " ", "-", " ", "currentCentroid"}], 
                 ")"}]}]}]}], ";", "\n", "\n", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
               "if", " ", "expansion", " ", "point", " ", "is", " ", 
                "successful"}], ",", " ", 
               RowBox[{
               "replace", " ", "current", " ", "worst", " ", "by", " ", 
                "expanded", " ", "point"}]}], "*)"}], "\n", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"objFunc", "@", "expansionPoint"}], "<", 
                "currentTrialValue"}], ",", "\n", 
               RowBox[{
                RowBox[{"NMStepWatcher", "=", "\"\<Expansion Success\>\""}], 
                ";", "\n", 
                RowBox[{"NewSimplex", " ", "=", " ", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"orderedcurrentSimplex", ",", " ", 
                   RowBox[{"3", "->", " ", "expansionPoint"}]}], "]"}]}], ";",
                 "\n", 
                RowBox[{"Goto", "[", "LoopEnd", "]"}], ";"}]}], "]"}], ";", 
             "\n", "\n", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"if", " ", "expansion", " ", "fails"}], ",", " ", 
               RowBox[{
               "then", " ", "just", " ", "replace", " ", "the", " ", 
                "current", " ", "worst", " ", "by", " ", "the", " ", "trial", 
                " ", "point"}]}], "*)"}], "\n", 
             RowBox[{"NMStepWatcher", "=", "\"\<Expansion Fail\>\""}], ";", 
             "\n", 
             RowBox[{"NewSimplex", "=", 
              RowBox[{"ReplacePart", "[", 
               RowBox[{"orderedcurrentSimplex", ",", " ", 
                RowBox[{"3", "->", " ", "currentTrialPoint"}]}], "]"}]}], ";",
              "\n", 
             RowBox[{"Goto", "[", "LoopEnd", "]"}], ";"}]}], "]"}], ";", "\n",
           "\n", 
          RowBox[{"(*", "Contraction", "*)"}], "\n", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "If", " ", "new", " ", "funcvalue", " ", "is", " ", "worst", " ", 
             "than", " ", "current", " ", "second", " ", "worst"}], ",", " ", 
            
            RowBox[{"perform", " ", "contraction"}]}], "*)"}], "\n", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"currentTrialValue", ">=", "MiddleValue"}], ",", "\n", 
            RowBox[{
             RowBox[{"NMStepWatcher", "=", "\"\<Contraction\>\""}], ";", "\n", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
               "If", " ", "new", " ", "funcvalue", " ", "is", " ", "better", 
                " ", "than", " ", "the", " ", "worst"}], ",", " ", 
               RowBox[{"contract", " ", "on", " ", "outside"}]}], "*)"}], 
             "\n", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"currentTrialValue", "<", "WorstValue"}], ",", "\n", 
               RowBox[{
                RowBox[{"NMStepWatcher", "=", "\"\<Outside Contraction\>\""}],
                 ";", "\n", 
                RowBox[{"currentContractedOutsidePoint", "=", 
                 RowBox[{"currentCentroid", "+", 
                  RowBox[{"\[Rho]", "*", 
                   RowBox[{"(", 
                    RowBox[{"currentTrialPoint", "-", "currentCentroid"}], 
                    ")"}]}]}]}], ";", "\n", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{
                  "If", " ", "new", " ", "contracted", " ", "value", " ", 
                   "is", " ", "better", " ", "than", " ", "trial"}], ",", " ", 
                  RowBox[{
                  "replace", " ", "worse", " ", "point", " ", "with", " ", 
                   "contracted", " ", "point"}]}], "*)"}], "\n", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"objFunc", "@", "currentContractedOutsidePoint"}], 
                   "<", "currentTrialValue"}], ",", "\n", 
                  RowBox[{
                   RowBox[{
                   "NMStepWatcher", "=", 
                    "\"\<Outside Contraction Success\>\""}], ";", "\n", 
                   RowBox[{"NewSimplex", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"orderedcurrentSimplex", ",", " ", 
                    RowBox[{"3", "->", "currentContractedOutsidePoint"}]}], 
                    "]"}]}], ";", "\n", 
                   RowBox[{"Goto", "[", "LoopEnd", "]"}], ";"}], ",", "\n", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"if", " ", "not"}], ",", " ", 
                    RowBox[{"go", " ", "to", " ", "shrink", " ", "step"}]}], 
                   "*)"}], "\n", 
                  RowBox[{
                   RowBox[{"Goto", "[", "ShrinkStep", "]"}], ";"}]}], "]"}], 
                ";"}]}], "\n", "]"}], ";", "\n", "\n", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
               "if", " ", "new", " ", "funcvalue", " ", "is", " ", "the", " ",
                 "worse", " ", "so", " ", "far"}], ",", " ", 
               RowBox[{"contract", " ", "on", " ", "inside"}]}], "*)"}], "\n", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"currentTrialValue", ">=", "WorstValue"}], ",", "\n", 
               RowBox[{
                RowBox[{"NMStepWatcher", "=", "\"\<Inside Contraction\>\""}], 
                ";", "\n", 
                RowBox[{"currentContractedInsidePoint", "=", 
                 RowBox[{"currentCentroid", " ", "+", " ", 
                  RowBox[{"\[Rho]", "*", 
                   RowBox[{"(", 
                    RowBox[{"WorstPoint", "-", "currentCentroid"}], 
                    ")"}]}]}]}], ";", "\n", "\t", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"objFunc", "@", "currentContractedInsidePoint"}], 
                   "<", "WorstValue"}], ",", "\n", "\t\t", 
                  RowBox[{
                   RowBox[{
                   "NMStepWatcher", "=", 
                    "\"\<Inside Contraction Success\>\""}], ";", "\n", "\t\t", 
                   RowBox[{"NewSimplex", "=", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"orderedcurrentSimplex", ",", 
                    RowBox[{"3", "->", "currentContractedInsidePoint"}]}], 
                    "]"}]}], ";", "\n", "\t\t", 
                   RowBox[{"Goto", "[", "LoopEnd", "]"}]}]}], "]"}], ";", 
                "\n", "\t", "\n", "\t", 
                RowBox[{"Goto", "[", "ShrinkStep", "]"}]}]}], "]"}]}]}], "\n",
            "]"}], ";", "\n", "\n", 
          RowBox[{"(*", 
           RowBox[{"Shrink", " ", "all", " ", "values"}], "*)"}], "\n", 
          RowBox[{"Label", "[", "ShrinkStep", "]"}], ";", "\n", 
          RowBox[{"NMStepWatcher", "=", "\"\<Shrink\>\""}], ";", "\n", 
          RowBox[{"NewSimplex", " ", "=", " ", 
           RowBox[{"ReplacePart", "[", 
            RowBox[{"orderedcurrentSimplex", ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"2", "->", " ", 
                RowBox[{"BestPoint", "+", 
                 RowBox[{"\[Sigma]nm", "*", 
                  RowBox[{"(", 
                   RowBox[{"MiddlePoint", "-", "BestPoint"}], ")"}]}]}]}], 
               ",", " ", 
               RowBox[{"3", "->", " ", 
                RowBox[{"BestPoint", "+", 
                 RowBox[{"\[Sigma]nm", "*", 
                  RowBox[{"(", 
                   RowBox[{"WorstPoint", "-", "BestPoint"}], ")"}]}]}]}]}], 
              "}"}]}], "]"}]}], ";", "\n", "\n", 
          RowBox[{"(*", 
           RowBox[{"repeat", " ", "loop"}], "*)"}], "\n", 
          RowBox[{"Label", "[", "LoopEnd", "]"}], ";", "\n", 
          RowBox[{"NMStepWatcher", "=", "\"\<Loop End\>\""}], ";", "\n", 
          RowBox[{"currentSimplex", " ", "=", " ", "NewSimplex"}], ";", "\n", 
          
          RowBox[{"currentFuncValues", " ", "=", " ", 
           RowBox[{"objFunc", "/@", "NewSimplex"}]}], ";", "\n", "\n", 
          RowBox[{"(*", 
           RowBox[{
           "populate", " ", "delta", " ", "holders", " ", "with", " ", 
            "current", " ", "deltas"}], "*)"}], "\n", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"\[Omega]deltaHolder", ",", " ", 
            RowBox[{
             RowBox[{"Max", "[", 
              RowBox[{"Norm", "/@", "currentSimplex"}], "]"}], " ", "-", " ", 
             
             RowBox[{"Min", "[", 
              RowBox[{"Norm", "/@", "currentSimplex"}], "]"}]}]}], "]"}], ";",
           "\n", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"FdeltaHolder", ",", " ", 
            RowBox[{
             RowBox[{"Max", "@", "currentFuncValues"}], " ", "-", " ", 
             RowBox[{"Min", "@", "currentFuncValues"}]}]}], "]"}], ";", "\n", 
          "\n", "\n", 
          RowBox[{"NMSnooper", "=", 
           RowBox[{"Min", "[", "currentFuncValues", "]"}]}], ";", "\n", 
          RowBox[{"NMSnooper2", "=", 
           RowBox[{"<|", 
            RowBox[{
             RowBox[{"\"\<\[Delta]\[Omega]\>\"", "->", " ", 
              RowBox[{"\[Omega]deltaHolder", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], ",", " ", 
             RowBox[{"\"\<\[Delta]F\>\"", "->", 
              RowBox[{"FdeltaHolder", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}]}], "|>"}]}], ";", "\n", 
          "\n", 
          RowBox[{"(*", 
           RowBox[{"update", " ", "termination", " ", "checkers"}], "*)"}], 
          "\n", 
          RowBox[{"PrecisionTermination", " ", "=", " ", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"PrecisionTerminator", "[", "currentFuncValues", "]"}], 
            "]"}]}], ";", "\n", 
          RowBox[{"AccuracyTermination", " ", "=", " ", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"AccuracyTerminator", "[", "currentSimplex", "]"}], 
            "]"}]}], ";", "\n", 
          RowBox[{"DeltaTermination", " ", "=", " ", 
           RowBox[{"Evaluate", "[", 
            RowBox[{"DeltaTerminator", "[", "\[Omega]deltaHolder", "]"}], 
            "]"}]}], ";", "\n", "\n", 
          RowBox[{"NMCounter", "++"}], ";"}]}], "\n", "]"}], ";", "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"PrecisionTermination", "&&", "Watcher"}], ",", " ", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<Termination due to precision goal! Value: \>\"", ",", " ", 
           RowBox[{"PrecisionTerminator", "[", "currentFuncValues", "]"}]}], 
          "]"}]}], "]"}], ";", "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"AccuracyTermination", "&&", "Watcher"}], ",", " ", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<Termination due to accuracy goal! Value: \>\"", ",", " ", 
           RowBox[{"AccuracyTerminator", "[", "currentSimplex", "]"}]}], 
          "]"}]}], "]"}], ";", "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"DeltaTermination", "&&", "Watcher"}], ",", " ", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<Termination due to unmoving deltas! Delta value: \>\"", ",", 
           " ", 
           RowBox[{"\[Omega]deltaHolder", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], "]"}], ";", " ", 
       "\n", 
       RowBox[{"orderingIndicies", " ", "=", " ", 
        RowBox[{"Ordering", "[", "currentFuncValues", "]"}]}], ";", "\n", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"currentFuncValues", "[", 
            RowBox[{"[", "orderingIndicies", "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"currentSimplex", "[", 
            RowBox[{"[", "orderingIndicies", "]"}], "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}]}]}], "\n", "]"}]}], 
   ";"}]}]], "Code",ExpressionUUID->"7c890fde-241c-472c-9ca2-e54471735f87"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RoughMinimize", "[", 
    RowBox[{
     RowBox[{"\[Omega]guess_", "?", "NumberQ"}], ",", " ", 
     RowBox[{"\[Nu]input_", "?", "NumberQ"}], ",", " ", 
     RowBox[{"\[Omega]boundary_", "?", "ListQ"}], ",", "  ", 
     RowBox[{"parameters_", "?", "AssociationQ"}], ",", " ", 
     RowBox[{"Watcher_", "?", "BooleanQ"}]}], "]"}], ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"SlopeTest", " ", "=", " ", 
        RowBox[{"-", "1"}]}], ",", " ", 
       RowBox[{"\[Omega]res", "=", 
        RowBox[{"parameters", "[", "\"\<omegaRes\>\"", "]"}]}], ",", " ", 
       RowBox[{"MaxX", "=", 
        RowBox[{"parameters", "[", "\"\<EndingX\>\"", "]"}]}]}], "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{",", 
       RowBox[{"\[Chi]", "=", 
        RowBox[{"parameters", "[", "\"\<\[Chi]\>\"", "]"}]}], ",", 
       RowBox[{"m", "=", 
        RowBox[{"parameters", "[", "\"\<m\>\"", "]"}]}], ",", " ", 
       RowBox[{"S", " ", "=", " ", 
        RowBox[{"parameters", "[", "\"\<s\>\"", "]"}]}], ",", 
       RowBox[{"\[Eta]", "=", 
        RowBox[{"parameters", "[", "\"\<\[Eta]\>\"", "]"}]}], ",", 
       RowBox[{"\[Mu]N", "=", 
        RowBox[{"parameters", "[", "\"\<\[Mu]Nv\>\"", "]"}]}]}], "*)"}], "\n", 
     RowBox[{
      RowBox[{"\[Omega]guessreal", " ", "=", " ", 
       RowBox[{"\[Omega]guess", "//", "Re"}]}], ";", "\n", 
      RowBox[{"\[Omega]guessim", " ", "=", " ", 
       RowBox[{"\[Omega]guess", "//", "Im"}]}], ";", "\n", 
      RowBox[{"\[Omega]boundaryceiling", " ", "=", " ", 
       RowBox[{"\[Omega]boundary", "//", "Last"}]}], ";", "\n", 
      RowBox[{"\[Omega]boundaryfloor", " ", "=", " ", 
       RowBox[{"\[Omega]boundary", "//", "First"}]}], ";", "\n", 
      RowBox[{"\[Delta]\[Omega]r", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
          "\[Omega]boundaryceiling", " ", "-", " ", "\[Omega]boundaryfloor"}],
           ")"}], "/", "\[Omega]res"}], "//", "Re"}]}], ";", "\n", 
      RowBox[{"\[Delta]\[Omega]i", " ", "=", " ", 
       RowBox[{"I", "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"\[Omega]guess", "/", "\[Omega]res"}], "//", "Im"}], "//", 
          "Abs"}], ")"}]}]}], ";", "\n", 
      RowBox[{"Print", "[", "\[Delta]\[Omega]i", "]"}], ";", "\n", 
      RowBox[{"Print", "[", "\[Delta]\[Omega]r", "]"}], ";", "\n", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"-", "First"}]}]}]}]}]}]}]}]}]}], " ", "minimize", 
        " ", "in", " ", "the", " ", "imaginary", " ", "direction", " ", "of", 
        " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"\[Omega]", "--"}], "--"}], "--"}], "--"}], 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", "-"}]}]}]}]}]}], "*)"}], "\n", 
      RowBox[{"\[Delta]\[Omega]", " ", "=", " ", "\[Delta]\[Omega]i"}], ";", 
      "\n", 
      RowBox[{"DIRECTION", "=", 
       RowBox[{"-", "1"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Pick", " ", "random", " ", "direction", " ", "to", " ", "probe", " ", 
        "the", " ", "sign", " ", "of", " ", "the", " ", "slope", " ", 
        RowBox[{"dR", "/", "d\[Omega]"}]}], "*)"}], "\n", 
      RowBox[{"CurrentRadialValue", " ", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"getRadialSolution", "[", 
           RowBox[{
           "\[Omega]guess", ",", " ", "\[Nu]input", ",", " ", "parameters"}], 
           "]"}], "[", "MaxX", "]"}], "//", "Abs"}], "//", "Log10"}]}], ";", 
      "\n", 
      RowBox[{"TestValue", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"getRadialSolution", "[", 
           RowBox[{
            RowBox[{"\[Omega]guess", "+", 
             RowBox[{"DIRECTION", "*", "\[Delta]\[Omega]"}]}], ",", 
            "\[Nu]input", ",", "parameters"}], "]"}], "[", "MaxX", "]"}], "//",
          "Abs"}], "//", "Log10"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "If", " ", "the", " ", "testvalue", " ", "is", " ", "larger", " ", 
         "than", " ", "the", " ", "currentvalue"}], ",", " ", 
        RowBox[{
        "then", " ", "we", " ", "picked", " ", "the", " ", "wrong", " ", 
         RowBox[{"direction", ".", " ", "Choose"}], " ", "the", " ", 
         "opposite", " ", "direction"}]}], "*)"}], "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"TestValue", "-", "CurrentRadialValue"}], ">", "0"}], ",", 
        " ", 
        RowBox[{"DIRECTION", " ", "*=", 
         RowBox[{"-", "1"}]}]}], "]"}], ";", "\n", "\n", 
      RowBox[{"counter", "=", "1"}], ";", "\n", 
      RowBox[{
       RowBox[{"ValueList", "[", "0", "]"}], "=", 
       RowBox[{"-", "1"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{"Watcher", ",", 
        RowBox[{
         RowBox[{"counterString", "=", 
          RowBox[{
          "\"\<[RoughMinimization] Section: Imaginary Section   Direction: \>\
\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"DIRECTION", ",", " ", "InputForm"}], "]"}], "<>", 
           "\"\<   Counter: \>\"", "<>", 
           RowBox[{"ToString", "[", "counter", "]"}]}]}], ";", 
         RowBox[{"Print", "@", 
          RowBox[{"Dynamic", "[", "counterString", "]"}]}]}]}], "]"}], ";", 
      "\n", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"SlopeTest", "<", "0"}], ",", "\n", 
        RowBox[{
         RowBox[{"NextFreq", " ", "=", " ", 
          RowBox[{"\[Omega]guess", " ", "+", " ", 
           RowBox[{"DIRECTION", "*", "counter", "*", "\[Delta]\[Omega]"}]}]}],
          ";", "\n", 
         RowBox[{"NextAngEigenValue", " ", "=", " ", 
          RowBox[{"getNuValue", "[", 
           RowBox[{"NextFreq", ",", " ", "parameters", ",", 
            RowBox[{"nuNNonRel", "[", 
             RowBox[{"NextFreq", ",", "parameters"}], "]"}]}], "]"}]}], ";", 
         " ", 
         RowBox[{"(*", 
          RowBox[{
          "Get", " ", "\[Nu]", " ", "value", " ", "from", " ", "solving", " ",
            "angular", " ", "equation", " ", "determinant"}], "*)"}], "\n", 
         "\n", 
         RowBox[{"NextValue", "  ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"getRadialSolution", "[", 
              RowBox[{
              "NextFreq", ",", " ", "NextAngEigenValue", ",", "parameters"}], 
              "]"}], "[", "MaxX", "]"}], "//", "Abs"}], "//", "Log10"}]}], 
         ";", "\n", "\n", 
         RowBox[{
          RowBox[{"ValueList", "[", "counter", "]"}], "=", "NextValue"}], ";",
          "\n", 
         RowBox[{
          RowBox[{"\[Omega]List", "[", "counter", "]"}], "=", "NextFreq"}], 
         ";", "\n", 
         RowBox[{
          RowBox[{"\[Nu]List", "[", "counter", "]"}], "=", 
          "NextAngEigenValue"}], ";", "\n", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"counter", "<=", "2"}], ",", 
           RowBox[{"-", "1"}], ",", " ", 
           RowBox[{
            RowBox[{"SlopeTest", " ", "=", 
             RowBox[{
              RowBox[{"ValueList", "[", "counter", "]"}], "-", " ", 
              RowBox[{"ValueList", "[", 
               RowBox[{"counter", "-", "1"}], "]"}]}]}], ";"}]}], "]"}], ";", 
         "\n", 
         RowBox[{"(*", 
          RowBox[{"Prevent", " ", "Infinite", " ", "loop"}], "*)"}], "\n", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"counter", ">", "1000"}], ",", " ", 
           RowBox[{
            RowBox[{
            "Print", "[", 
             "\"\<RoughMinimization step surpassed 1000 iterations! \
Breaking...\>\"", "]"}], ";", 
            RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", "\n", "\n", 
         RowBox[{"counter", "++"}], ";", "\n", 
         RowBox[{"If", "[", 
          RowBox[{"Watcher", ",", 
           RowBox[{"counterString", "=", 
            RowBox[{
            "\"\<[RoughMinimization] Section: Imaginary Section   Direction: \
\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"DIRECTION", ",", " ", "InputForm"}], "]"}], "<>", 
             "\"\<   Counter: \>\"", "<>", 
             RowBox[{"ToString", "[", "counter", "]"}], "<>", 
             "\"\< \\n Slope Test: \>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"SlopeTest", ",", " ", "InputForm"}], "]"}], "<>", 
             "\"\<\\n Current Position: \>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"NextFreq", ",", " ", "InputForm"}], "]"}]}]}]}], "]"}],
          ";"}]}], "\n", "]"}], ";", "\n", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Imaginary Part: \>\"", ",", " ", 
        RowBox[{
         RowBox[{"\[Omega]List", "[", 
          RowBox[{"counter", "-", "1"}], "]"}], "//", "Im"}]}], "]"}], ";", 
      "\n", "\n", "\n", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"-", "Then"}]}]}]}]}]}]}]}]}]}], " ", "minimize", 
         " ", "in", " ", "the", " ", "real", " ", "direction", " ", "of", " ",
          "\[Omega]"}], ",", " ", 
        RowBox[{
        "taking", " ", "as", " ", "guess", " ", "the", " ", "previous", " ", 
         "result", " ", "of", " ", "the", " ", "imaginary", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"minimization", "--"}], "--"}], "--"}], "--"}], 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", "-"}]}]}]}]}]}]}], "*)"}], "\n", 
      RowBox[{"\[Delta]\[Omega]", " ", "=", " ", "\[Delta]\[Omega]r"}], ";", 
      "\n", 
      RowBox[{"\[Omega]guess2", " ", "=", " ", 
       RowBox[{"\[Omega]List", "[", 
        RowBox[{"counter", "-", "1"}], "]"}]}], ";", "\n", 
      RowBox[{"\[Nu]input2", " ", "=", " ", 
       RowBox[{"\[Nu]List", "[", 
        RowBox[{"counter", "-", "1"}], "]"}]}], ";", "\n", 
      RowBox[{"DIRECTION", "=", 
       RowBox[{"-", "1"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
       "Pick", " ", "random", " ", "direction", " ", "to", " ", "probe", " ", 
        "the", " ", "sign", " ", "of", " ", "the", " ", "slope", " ", 
        RowBox[{"dR", "/", "d\[Omega]"}]}], "*)"}], "\n", 
      RowBox[{"CurrentRadialValue", " ", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"getRadialSolution", "[", 
           RowBox[{
           "\[Omega]guess2", ",", " ", "\[Nu]input2", ",", " ", 
            "parameters"}], "]"}], "[", "MaxX", "]"}], "//", "Abs"}], "//", 
        "Log10"}]}], ";", "\n", 
      RowBox[{"TestValue", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"getRadialSolution", "[", 
           RowBox[{
            RowBox[{"\[Omega]guess2", "+", 
             RowBox[{"DIRECTION", "*", "\[Delta]\[Omega]"}]}], ",", 
            "\[Nu]input2", ",", "parameters"}], "]"}], "[", "MaxX", "]"}], "//",
          "Abs"}], "//", "Log10"}]}], ";", "\n", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "If", " ", "the", " ", "testvalue", " ", "is", " ", "larger", " ", 
         "than", " ", "the", " ", "currentvalue"}], ",", " ", 
        RowBox[{
        "then", " ", "we", " ", "picked", " ", "the", " ", "wrong", " ", 
         RowBox[{"direction", ".", " ", "Choose"}], " ", "the", " ", 
         "opposite", " ", "direction"}]}], "*)"}], "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"TestValue", "-", "CurrentRadialValue"}], ">", "0"}], ",", 
        " ", 
        RowBox[{"DIRECTION", "=", 
         RowBox[{
          RowBox[{"-", "1"}], "*", "DIRECTION"}]}]}], "]"}], ";", "\n", "\n", 
      
      RowBox[{"counter", "=", "1"}], ";", "\n", 
      RowBox[{
       RowBox[{"ValueList", "[", "0", "]"}], "=", 
       RowBox[{"-", "1"}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{"Watcher", ",", 
        RowBox[{"counterString", "=", 
         RowBox[{
         "\"\<[RoughMinimization] Section: Real Section   Direction: \>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"DIRECTION", ",", " ", "InputForm"}], "]"}], "<>", 
          "\"\<   Counter: \>\"", "<>", 
          RowBox[{"ToString", "[", "counter", "]"}]}]}]}], "]"}], ";", "\n", 
      "\n", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"SlopeTest", "<", "0"}], ",", "\n", 
        RowBox[{
         RowBox[{"NextFreqRealPart", " ", "=", " ", 
          RowBox[{"\[Omega]guessreal", " ", "+", " ", 
           RowBox[{"DIRECTION", "*", "counter", "*", "\[Delta]\[Omega]"}]}]}],
          ";", "\n", 
         RowBox[{"NextFreq", " ", "=", " ", 
          RowBox[{"NextFreqRealPart", " ", "+", " ", 
           RowBox[{"I", "*", "\[Omega]guessim"}]}]}], ";", " ", 
         RowBox[{"(*", 
          RowBox[{"Better", " ", "input", " ", "for", " ", "imaginary", " ", 
           RowBox[{"part", "?"}]}], "*)"}], "\n", 
         RowBox[{"NextAngEigenValue", " ", "=", " ", 
          RowBox[{"getNuValue", "[", 
           RowBox[{"NextFreq", ",", " ", "parameters", ",", 
            RowBox[{"nuNNonRel", "[", 
             RowBox[{"NextFreq", ",", "parameters"}], "]"}]}], "]"}]}], ";", 
         " ", 
         RowBox[{"(*", 
          RowBox[{
          "Get", " ", "\[Nu]", " ", "value", " ", "from", " ", "solving", " ",
            "angular", " ", "equation", " ", "determinant"}], "*)"}], "\n", 
         "\n", 
         RowBox[{"NextValue", "  ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"getRadialSolution", "[", 
              RowBox[{
              "NextFreq", ",", " ", "NextAngEigenValue", ",", "parameters"}], 
              "]"}], "[", "MaxX", "]"}], "//", "Abs"}], "//", "Log10"}]}], 
         ";", "\n", "\n", 
         RowBox[{
          RowBox[{"ValueList", "[", "counter", "]"}], "=", "NextValue"}], ";",
          "\n", 
         RowBox[{
          RowBox[{"\[Omega]List", "[", "counter", "]"}], "=", "NextFreq"}], 
         ";", "\n", 
         RowBox[{
          RowBox[{"\[Nu]List", "[", "counter", "]"}], "=", 
          "NextAngEigenValue"}], ";", "\n", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"counter", "<=", "2"}], ",", 
           RowBox[{"-", "1"}], ",", " ", 
           RowBox[{
            RowBox[{"SlopeTest", " ", "=", 
             RowBox[{
              RowBox[{"ValueList", "[", "counter", "]"}], "-", " ", 
              RowBox[{"ValueList", "[", 
               RowBox[{"counter", "-", "1"}], "]"}]}]}], ";"}]}], "]"}], ";", 
         "\n", 
         RowBox[{"(*", 
          RowBox[{"Prevent", " ", "Infinite", " ", "loop"}], "*)"}], "\n", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"counter", ">", "1000"}], ",", " ", 
           RowBox[{
            RowBox[{
            "Print", "[", 
             "\"\<RoughMinimization step surpassed 1000 iterations! \
Breaking...\>\"", "]"}], ";", 
            RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", "\n", "\n", 
         RowBox[{"counter", "++"}], ";", "\n", 
         RowBox[{"If", "[", 
          RowBox[{"Watcher", ",", 
           RowBox[{"counterString", "=", 
            RowBox[{
            "\"\<[RoughMinimization] Section: Real Section   Direction: \>\"",
              "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"DIRECTION", ",", " ", "InputForm"}], "]"}], "<>", 
             "\"\<   Counter: \>\"", "<>", 
             RowBox[{"ToString", "[", "counter", "]"}], "<>", 
             "\"\< \\n Slope Test: \>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"SlopeTest", ",", " ", "InputForm"}], "]"}], "<>", 
             "\"\<\\n Current Position: \>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"NextFreq", ",", " ", "InputForm"}], "]"}]}]}]}], "]"}],
          ";"}]}], "\n", "]"}], ";", "\n", "\n", "\n", "\n", 
      RowBox[{"RoughMinimizationResults", " ", "=", " ", 
       RowBox[{
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<\[Omega]\>\"", "->", " ", 
           RowBox[{"\[Omega]List", "[", 
            RowBox[{"counter", "-", "1"}], "]"}]}], ",", " ", 
          RowBox[{"\"\<\[Nu]\>\"", "->", " ", 
           RowBox[{"\[Nu]List", "[", 
            RowBox[{"counter", "-", "1"}], "]"}]}]}], "|>"}], "//", 
        RowBox[{"ToPrecision", "[", "parameters", "]"}]}]}], " ", ";", "\n", 
      RowBox[{"Return", "[", 
       RowBox[{"RoughMinimizationResults", ",", " ", "Module"}], "]"}]}]}], 
    "\n", "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.862112760470726*^9, 3.862112766616446*^9}, {
   3.862113037112208*^9, 3.862113057105764*^9}, 3.862113431710822*^9, {
   3.862113593347519*^9, 3.8621136419826803`*^9}, {3.86211367885944*^9, 
   3.862113869418806*^9}, {3.862113924922923*^9, 3.8621139724393997`*^9}, {
   3.862114204461768*^9, 3.862114213632248*^9}, {3.8621147124724703`*^9, 
   3.862114712985571*^9}, {3.862116421336879*^9, 3.8621164539863577`*^9}, {
   3.862116838013781*^9, 3.8621168422262278`*^9}, {3.862116931111082*^9, 
   3.862116939540917*^9}, {3.862117065025152*^9, 3.862117114612854*^9}, 
   3.8621171494973183`*^9, {3.862117205508328*^9, 3.862117209241766*^9}, {
   3.8621173373835278`*^9, 3.862117339069312*^9}, {3.8621188103353*^9, 
   3.862118826196394*^9}, {3.862119057368691*^9, 3.862119072826363*^9}, {
   3.862119110747259*^9, 3.862119112289435*^9}, {3.862119145170266*^9, 
   3.862119150678061*^9}, {3.8621191869043903`*^9, 3.862119196669447*^9}, 
   3.862119244076725*^9, {3.862119806905752*^9, 
   3.862119840107717*^9}},ExpressionUUID->"cba8d921-82a5-441e-b497-\
f7fe2657b872"]
}, Closed]]
},
WindowSize->{720, 756},
WindowMargins->{{Automatic, 0}, {0, Automatic}},
FrontEndVersion->"13.0 for Linux x86 (64-bit) (February 4, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"1fcb6970-7300-45bf-aaca-b05b7b809134"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{
 "CalculationFunctions"->{
  Cell[7839, 200, 138554, 3344, 14510, "Input",ExpressionUUID->"ab866a9e-9a86-42d8-9743-8ad7a09dea3d",
   CellTags->"CalculationFunctions"]}
 }
*)
(*CellTagsIndex
CellTagsIndex->{
 {"CalculationFunctions", 229851, 5438}
 }
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 6277, 149, 619, "Input",ExpressionUUID->"b0602965-dfc1-41f7-b9ca-eacc8b02c1dc"],
Cell[CellGroupData[{
Cell[6860, 173, 218, 4, 54, "Subsection",ExpressionUUID->"821cf547-bc04-4bb9-a3f8-20108d5951a7"],
Cell[7081, 179, 755, 19, 71, "Input",ExpressionUUID->"e93cffd4-3faa-46cb-9096-8d3ba53c08f1"],
Cell[7839, 200, 138554, 3344, 14510, "Input",ExpressionUUID->"ab866a9e-9a86-42d8-9743-8ad7a09dea3d",
 CellTags->"CalculationFunctions"],
Cell[146396, 3546, 39755, 882, 4990, "Input",ExpressionUUID->"b427287e-6470-4bd2-96fe-d8b7e07f5bb0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[186188, 4433, 272, 4, 54, "Subsection",ExpressionUUID->"518c50da-c7a6-45eb-8b1f-e2749f381851"],
Cell[186463, 4439, 3409, 85, 417, "Input",ExpressionUUID->"433b2a71-144e-4207-9bad-82ae40d9be12",
 InitializationCell->True],
Cell[189875, 4526, 21359, 466, 2572, "Code",ExpressionUUID->"7c890fde-241c-472c-9ca2-e54471735f87"],
Cell[211237, 4994, 18245, 430, 1647, "Code",ExpressionUUID->"cba8d921-82a5-441e-b497-f7fe2657b872"]
}, Closed]]
}
]
*)

